var DependencyMap;!function(a){"use strict";a.version="2.0.5"}(DependencyMap||(DependencyMap={}));var DependencyMap;!function(a){"use strict";!function(a){a[a.Information=0]="Information",a[a.Warning=1]="Warning",a[a.Error=2]="Error",a[a.InProgress=3]="InProgress",a[a.Success=4]="Success"}(a.NotificationStatus||(a.NotificationStatus={}));var b=function(){function a(){}return a.GenerateMap="GenerateMap",a.GetCoarseMap="GetCoarseMap",a.GetMachineDetails="GetMachineDetails",a.GetClientGroupMembers="GetClientGroupMembers",a.GetServerGroupMembers="GetServerGroupMembers",a.LoadServerMap="LoadServerMap",a.ToggleSelfLinks="ToggleSelfLinks",a.OpenLegend="OpenLegend",a.CloseLegend="CloseLegend",a.ContextMenu="ContextMenu",a.ToggleProcessFilter="ToggleProcessFilter",a.ExpandAllNodes="ExpandAllNodes",a.NavigateToHelpPage="NavigateToHelpPage",a.CollapseAllNodes="CollapseAllNodes",a.Alerts="Alerts",a.LogEvents="LogEvents",a}();a.TelemetryOperations=b;var c=function(){function a(){}return a.LoadMap="LoadMap",a.ExpandClientGroup="ExpandClientGroup",a.ExpandServerGroup="ExpandServerGroup",a.ExpandMachine="ExpandMachine",a}();a.TelemetryUserActions=c;var d=function(){function a(){}return a.debug=function(a,b,c,d,e){this.trace(a,0,b,c,d,e)},a.info=function(a,b,c,d,e){this.trace(a,1,b,c,d,e)},a.warn=function(a,b,c,d,e){this.trace(a,2,b,c,d,e)},a.error=function(b,c,d,e,f){var g;g="object"==typeof b?JSON.stringify(b):b,f=f||{},f.message=f.message||(e||d)+" failed.",a.shimCustomObject(b),this.events[e]?this.stopTracking(e,(f.error=g,f.isError="true",f),3):a.telemetry&&a.telemetry.trackException(g,c+"."+d,f)},a.startTracking=function(b,c,d){void 0===d&&(d=1),this.events[b]&&delete this.events[b];var e=""+a.sequenceNumber++;return this.events[b]={id:e,start:new Date,level:d,source:c},e},a.stopTracking=function(a,b,c){var d=this.events[a];if(d&&d.start){var e=(new Date).valueOf()-d.start.valueOf();if(e>2e5)return void this.discardTracking(a);if(b=b||{},b.duration=e,d.steps&&d.steps.length>0){d.steps.sort(function(a,b){return a.time.getTime()-b.time.getTime()});for(var f=d.start,g=0;g<d.steps.length;g++){var h=d.steps[g],i="step"+g+"_"+h.name,j={duration:h.time.valueOf()-f.valueOf(),info:h.message};b[i]=JSON.stringify(j),f=h.time}}var k=b.message||a+" completed.";this.trace(k,c||d.level,d.source,a,b,d.parentId),this.discardTracking(a)}},a.isTracking=function(a){return this.events.hasOwnProperty(a)},a.discardTracking=function(a){this.isTracking(a)&&delete this.events[a]},a.trackStep=function(b,c,d){var e=this.events[b];if(e&&e.start){e.steps||(e.steps=[]);var f={name:c,time:new Date,message:d};e.steps.push(f),a.trackUserAction(f)}},a.stopAllOperationTrackings=function(){if(this.events)for(var a in this.events)delete this.events[a];this.events={}},a.startTrackingUserAction=function(a,b,c,d){this.userActionTelemetry={id:a,source:b,start:new Date,level:1,correlationId:c,steps:[],properties:d}},a.trackUserAction=function(a){this.userActionTelemetry&&this.userActionTelemetry.steps.push(a)},a.stopTrackingUserAction=function(a,b,c){if(this.userActionTelemetry){var d=(new Date).valueOf()-this.userActionTelemetry.start.valueOf(),e=this.userActionTelemetry.properties||{};e.duration=d,this.traceDependency(this.userActionTelemetry.correlationId,this.userActionTelemetry.id,void 0,this.userActionTelemetry.source,d,a,b);var f=this.userActionTelemetry;if(f.steps&&f.steps.length>0){f.steps=f.steps.sort(function(a,b){return a.time.getTime()-b.time.getTime()});for(var g=f.start,h=0;h<f.steps.length;h++){var i=f.steps[h],j="step"+h+"_"+i.name,k=i.time.valueOf()-g.valueOf();e[j]=k}}this.trace("User action "+this.userActionTelemetry.id+" completed.",1,this.userActionTelemetry.source,this.userActionTelemetry.id,e,null),this.userActionTelemetry=null}},a.notifyClient=function(b,c,d){a.telemetry.notifyClient(b,c,d)},a.traceDependency=function(b,c,d,e,f,g,h){a.telemetry&&a.telemetry.trackDependency&&a.telemetry.trackDependency(b,c,d,e,f,g,h)},a.trace=function(a,b,c,d,e,f){this.traceTelemetryEvent(a,b,c,d,e)},a.traceTelemetryEvent=function(b,c,d,e,f){if(d&&e&&(f=f||{},f=a.globalContext?$.extend(f,a.globalContext):f,f.message=b,f.source=d,f.action=e,f.trace_level=c,a.telemetry&&a.telemetry.trackEvent&&a.telemetry.trackEvent(d+"."+e,f),a.TRACE_CONSOLE)){var g=JSON.stringify(f);console.info("Operation:: "+d+"."+e+", Properties::"+g)}},a.convertTypeToString=function(a){switch(a){case 0:return"Machine";case 1:return"Process";case 2:return"Port";case 3:return"Connection";case 4:return"Acceptor";case 5:return"ClientGroup";case 6:return"ClientGroupMember";case 7:return"ServerGroup";case 8:return"MachineWithHints";case 9:return"MachineGroup";case 10:return"ProcessGroup";case 11:return"UnconnectedProcessGroup";case 12:return"AggregatedConnection";case 13:return"NewClientGroup";case 14:return"NewServerGroup";case 15:return"ClientOrServerGroupMember";case 16:case 17:default:return"Unknown"}},a.shimCustomObject=function(a){"object"!=typeof a||a.hasOwnProperty("toJSON")||Object.defineProperty(a,"toJSON",{value:function(){var b={};return Object.getOwnPropertyNames(a).forEach(function(c){b[c]=a[c]}),b},configurable:!0,writable:!0})},a.TRACE_CONSOLE=!1,a.events={},a.sequenceNumber=0,a}();a.TelemetryProvider=d}(DependencyMap||(DependencyMap={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),DependencyMap;!function(a){"use strict";var b=a.TelemetryProvider,c=function(){function a(){}return a.createFromArmEntity=function(a){if(!a)throw new Error("Null entity provided to AdmViewModelFactory");var b,c=this.getArmEntityId(a);switch(this.getArmEntityType(a)){case 0:b=new k(c,a);break;case 1:b=new o(c,a);break;case 2:b=new p(c,a);break;case 5:b=new q(c,a);break;case 3:b=new G(c,a);break;case 4:b=new H(c,a);break;case 6:b=new r(c,a);break;case 8:b=new l(c,a);break;case 9:b=new m(c,a);break;case 10:b=new n(c,a);break;case 12:b=new D(c,a);break;case 7:b=new A(c,a);break;default:throw new Error("Unsupported entity type")}return b.armId=a.id,b.armName=a.name,a.etag&&(b.etag=a.etag),b},a.getArmEntityId=function(a){if(!a||!a.id||!a.name)throw new Error("Null entity or entity name");return a.id},a.getArmEntityType=function(a){if(!a||!a.type)throw new Error("Null entity or entity type");var b=a.type.split("/");if(!b||0==b.length)throw new Error("Invalid entity type");switch(b.pop().toLowerCase()){case"machines":case"machine":return"ref:machinewithhints"===a.kind?8:0;case"machinegroup":case"machinegroups":return 9;case"processes":case"process":return 1;case"ports":case"port":return 2;case"clientgroups":case"clientgroup":return 5;case"connections":case"connection":return 3;case"acceptors":case"acceptor":return 4;case"members":case"member":return 6;case"processgroup":case"processgroups":return 10;case"aggconnection":case"aggconnections":return 12;case"servergroup":case"servergroups":return 7;default:throw new Error("Unsupported entity type")}},a.getArmSkipToken=function(a){var b=decodeURIComponent(a),c="\\"+this.ARM_SKIP_TOKEN_PARAM;return this.getParameterByName(c,b)},a.isNodeMonitored=function(a){return!a||"monitored"===a.toLowerCase()},a.getParameterByName=function(a,b){if(!b)return null;a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d&&d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):null},a.deepCopyAllProperties=function(b,c){for(var d=0,e=Object.keys(b);d<e.length;d++){var f=e[d];f&&(b[f]instanceof Array?(c[f]=[],a.deepCopyAllProperties(b[f],c[f])):b[f]instanceof Object?(c[f]={},a.deepCopyAllProperties(b[f],c[f])):c[f]=b[f])}},a.ARM_SKIP_TOKEN_PARAM="$skipToken",a}();a.AdmViewModelFactory=c;var d=function(){function a(a,b){this.id=a,this.type=b}return a}();a.Entity=d;var e=function(a){function b(b,c,d){return a.call(this,b,d)||this}return __extends(b,a),b.prototype.toApi=function(){throw new Error("toApi method not implemented")},b}(d);a.ArmEntity=e;var f=function(a){function b(b,c){var d=a.call(this,b,c)||this;return d.isVisible=!0,d.isInLayout=!0,d}return __extends(b,a),b}(d);a.MapEntity=f;var g=function(a){function b(b,c){var d=a.call(this,b,c)||this;return d.isHighlighted=!1,d.selfLinksVisible=!1,d.loadServerMapEnabled=!0,d.inboundConnections=[],d.outboundConnections=[],d.failedConnections=[],d.inboundSelfConnections=[],d.outboundSelfConnections=[],d.clientNodes={},d.serverNodes={},d.badges=[],d.maxBadgeEmphasis=0,d}return __extends(b,a),b.prototype.addConnection=function(a,b,c,d){a&&(b?(this.inboundConnections.push(a),d&&this.inboundSelfConnections.push(a)):(this.outboundConnections.push(a),d&&this.outboundSelfConnections.push(a)),c&&this.failedConnections.push(a))},b.prototype.addConnectedNode=function(a,b){if(a){var c=b?this.clientNodes:this.serverNodes;c[a.type]||(c[a.type]={}),c[a.type][a.id]=a}},b}(f);a.MapNode=g;var h=function(a){function b(b,c){return a.call(this,b,c)||this}return __extends(b,a),b}(f);a.MapEdge=h;var i=function(a){function b(b,d,e){var f=a.call(this,b,e)||this;return d?(f.displayName=d.properties&&d.properties.displayName||d.name,f.isMonitored=d.properties&&c.isNodeMonitored(d.properties.monitoringState),f):f}return __extends(b,a),b.prototype.toApi=function(){throw new Error("toApi method not implemented")},b}(g);a.ArmMapNode=i;var j=function(a){function b(b,c,d){return a.call(this,b,d)||this}return __extends(b,a),b.prototype.toApi=function(){throw new Error("toApi method not implemented")},b}(h);a.ArmMapEdge=j;var k=function(a){function d(b,c){var d=a.call(this,b,c,0)||this;return d.NAME="Machine_AdmViewModelFactory",d.updateProperties(c),d.roleCounts={},d.processGroups=[],d.processes=[],d.expanded=!1,d}return __extends(d,a),d.prototype.getConnectedServerCount=function(){try{if(this.serverNodes){var a=0;if(this.serverNodes[0]&&(a+=Object.keys(this.serverNodes[0]).length),this.serverNodes[14])for(var c=0,d=Object.keys(this.serverNodes[14]);c<d.length;c++){var e=d[c],f=this.serverNodes[14][e];a+=f.getMonitoredMemberCount(),a+=f.getDiscoveredMemberCount()}return a}}catch(a){b.error(a,this.NAME,"getConnectedServerCount",null,{message:"Failed to get Connected Server Count",id:this.id})}return null},d.prototype.getConnectedClientCount=function(){try{if(this.clientNodes){var a=0;if(this.clientNodes[0]&&(a+=Object.keys(this.clientNodes[0]).length),this.clientNodes[13])for(var c=0,d=Object.keys(this.clientNodes[13]);c<d.length;c++){var e=d[c],f=this.clientNodes[13][e];a+=f.getMonitoredMemberCount(),a+=f.getDiscoveredMemberCount()}return a}}catch(a){b.error(a,this.NAME,"getConnectedClientCount",null,{message:"Failed to get Connected Client Count.",id:this.id})}return null},d.createFromHints=function(a,b){var c=b;return c.properties.displayName=b.properties.displayNameHint,c.properties.operatingSystem={family:b.properties.osFamilyHint},new d(a,c)},d.osFamilyToFamilyType=function(a){switch(a.toLowerCase()){case"windows":return 1;case"linux":return 2;case"solaris":return 3;case"aix":return 4;default:return 0}},d.ipInterfaceToCidrNotation=function(a){if(!a||!a.ipAddress)return"";if(!a.subnetMask)return a.ipAddress;for(var b=0,c=a.subnetMask.split("."),d=0,e=c;d<e.length;d++)for(var f=e[d],g=Number(f);g;)b+=1,g&=g-1;return a.ipAddress+"/"+b},d.cloudServiceTypeFromString=function(a){if(!a)return 0;switch(a.toLowerCase()){case"worker":return 1;case"web":return 2;default:return 0}},d.prototype.updateProperties=function(a){if(a&&a.properties){if(c.deepCopyAllProperties(a.properties,this),a.properties.operatingSystem){var b=d.osFamilyToFamilyType(a.properties.operatingSystem.family);this.operatingSystem.familyType=b,this.operatingSystemType=b}else this.operatingSystemType=0;if(a.properties.networking&&a.properties.networking.ipv4Interfaces)for(var e=0,f=this.networking.ipv4Interfaces;e<f.length;e++){var g=f[e];g.cidrNotation=d.ipInterfaceToCidrNotation(g)}a.properties.hosting&&a.properties.hosting.cloudService&&(this.hosting.cloudService.roleType=d.cloudServiceTypeFromString(a.properties.hosting.cloudService.roleType))}},d.prototype.addProcessGroup=function(a){a&&this.processGroups.push(a)},d.prototype.addProcess=function(a){if(a){this.processes.push(a);var b=a.role;0!==b&&-1!==b&&(this.roleCounts[b]+=1)}},d.prototype.getAllIpAddresses=function(){var a=[];if(this.networking&&this.networking.ipv4Interfaces)for(var b=0,c=this.networking.ipv4Interfaces;b<c.length;b++){var d=c[b];a.push(d.ipAddress)}if(this.networking&&this.networking.ipv6Interfaces)for(var e=0,f=this.networking.ipv6Interfaces;e<f.length;e++){var g=f[e];a.push(g.ipAddress)}return a},d.prototype.getHealth=function(){return this.failedConnections&&this.failedConnections.length>0?"Critical":"Nominal"},d}(i);a.Machine=k;var l=function(a){function b(b,c){var d=a.call(this,b,c,8)||this;return d.live=!0,c&&c.properties&&(d.displayName=c.properties.displayNameHint,d.osFamilyType=k.osFamilyToFamilyType(c.properties.osFamilyHint)),d}return __extends(b,a),b.createFromMachine=function(a){var c=new b(a.id,null);return c.armId=a.armId,c.armName=a.armName,c.displayName=a.displayName,c.osFamilyType=a.operatingSystem.familyType,c},b.prototype.toApi=function(){return{id:this.armId,name:this.armName,properties:{displayNameHint:this.displayName,osFamilyHint:""}}},b}(e);a.MachineStub=l;var m=function(a){function b(b,d){var e=a.call(this,b,d,9)||this;return d&&d.properties?(e.displayName=d.properties.displayName,e.groupType=e.getMachineGroupTypeFromString(d.properties.groupType),e.machines=d.properties.machines.map(function(a){return c.createFromArmEntity(a)})):(e.displayName="",e.groupType=3,e.machines=[]),e}return __extends(b,a),b.prototype.toApi=function(){var a=this.machines.map(function(a){return a.toApi()});return{id:this.armId,name:this.armName,etag:this.etag,properties:{displayName:this.displayName,groupType:null,machines:a}}},b.prototype.addMachines=function(a){if(a)for(var b=0,c=a;b<c.length;b++){var d=c[b];this.machines.push(l.createFromMachine(d))}},b.prototype.getMachineGroupTypeFromString=function(a){switch(a){case"azure-cs":return 0;case"azure-sf":return 1;case"azure-vmss":return 2;default:return 3}},b}(e);a.MachineGroup=m;var n=function(a){function b(b,c){var d=a.call(this,b,c,10)||this;return d.processes=[],d.clientGroup=null,c.properties.machine?d.machineId=c.properties.machine.id:c.properties.hostingMachine&&(d.machineId=c.properties.hostingMachine.id),d}return __extends(b,a),b.prototype.addProcess=function(a){a&&this.processes.push(a)},b}(i);a.ProcessGroup=n;var o=function(a){function b(d,e){var f=a.call(this,d,e,1)||this;return c.deepCopyAllProperties(e.properties,f),f.machineId=c.getArmEntityId(e.properties.machine),e.properties.acceptorOf&&(f.acceptorOfId=c.getArmEntityId(e.properties.acceptorOf)),e.properties.clientOf&&(f.clientOfId=c.getArmEntityId(e.properties.clientOf)),e.properties.group&&(f.group=e.properties.group),f.role=b.getProcessRoleType(e.properties.role),f.processGroup=null,f.ports=[],f}return __extends(b,a),b.prototype.addPort=function(a){a&&"0.0.0.0"!=a.ipAddress&&this.ports.push(a)},b.prototype.getPortNumbers=function(){for(var a={},b=0,c=this.ports;b<c.length;b++){a[c[b].portNumber]=!0}return Object.keys(a)},b.getProcessRoleType=function(a){if(!a)return 0;switch(a.toLowerCase()){case"webserver":return 1;case"appserver":return 2;case"databaseserver":return 3;case"ldapserver":return 4;case"smbserver":return 5;default:return-1}},b}(i);a.Process=o;var p=function(a){function b(b,d){var e=a.call(this,b,d,2)||this;return c.deepCopyAllProperties(d.properties,e),e.isMonitored=c.isNodeMonitored(d.properties.monitoringState),e.machineId=c.getArmEntityId(d.properties.machine),e}return __extends(b,a),b}(e);a.Port=p;var q=function(a){function b(b,d){var e=a.call(this,b,d,5)||this;return e.destinationId=c.getArmEntityId(d.properties.clientsOf),e.destination=null,e.memberCount=0,e.unmonitoredMemberCount=0,e.isApproximate=!1,e.members=[],e.unmonitoredMembers=[],e.membersSkipToken="",e.isVisible=!1,e}return __extends(b,a),b.prototype.setDestinationEntity=function(a){this.destination=a,this.displayName=a.displayName},b.prototype.updateCount=function(a){if(!a)throw new Error("Null member count provided to client group "+this.id);this.isApproximate="estimated"==a.accuracy,this.memberCount=a.count},b.prototype.updateMembers=function(a,b){if(!a||!a.value)throw new Error("Null members collection provided to client group "+this.id);if(!this.destination)throw new Error("Set client group destionation before updating members");this.membersSkipToken=c.getArmSkipToken(a.nextLink);for(var d=[],e=0,f=a.value;e<f.length;e++){var g=f[e],h=c.createFromArmEntity(g),i=b.entities[h.portId];i&&(h.portNumber=i.portNumber);var j=b.ips[h.ipAddress];j&&(h.machine=j),d.push(h)}for(var k=this.members.concat(d),l=this.destination.clientNodes[0]||{},m={},n=[],o=0,p=k;o<p.length;o++){var g=p[o],q=b.ips[g.ipAddress];q&&l.hasOwnProperty(q.id)||(m[g.ipAddress]=!0,n.push(g))}var r=Object.keys(m).length,s=Object.keys(l).length;this.unmonitoredMemberCount=r,this.memberCount=r+s,this.isVisible=r>0,this.isApproximate=null!=this.membersSkipToken&&""!=this.membersSkipToken,this.unmonitoredMembers=n,this.members=k},b.prototype.getNodeDisplayName=function(a,b){var c=""+this.unmonitoredMemberCount;return this.isApproximate?c+="+ ":c+=" ",this.unmonitoredMemberCount>1?c+=b:c+=a,c},b}(i);a.ClientGroup=q;var r=function(a){function b(b,d){var e=a.call(this,b,d,6)||this;e.processIds=[],e.ipAddress=d.properties.ipAddress,e.portId=c.getArmEntityId(d.properties.port);for(var f=0,g=d.properties.processes;f<g.length;f++){var h=g[f];e.processIds.push(c.getArmEntityId(h))}return e}return __extends(b,a),b}(e);a.ClientGroupMember=r;var s=function(a){function b(b,c){var d=a.call(this,b,7)||this;return d.memberViewModels=[],d.port=c,d.displayName=c.displayName,d.isMonitored=!0,d.role=0,d}return __extends(b,a),b.prototype.addMember=function(a){a&&this.memberViewModels.push(a)},b.prototype.getNodeSubheader=function(a){var b=this.memberViewModels;return b&&0!==b.length?b.length>1?b.length+" "+a:b[0].displayName:""},b}(g);a.ServerGroup=s;var t=function(){function a(a){this.machineName=a.machine,this.processName=a.process,a.processId&&a.processId.id&&(this.process=new o(a.processId.id,a.processId)),this.isMonitored=c.isNodeMonitored(a.monitoringState)}return a}();a.GroupMemberConnectionEndpoint=t;var u=function(){function a(a){this.serverPort=a.portNumber,this.failureState=G.getFailureState(a.failureState),this.source=new t(a.source),this.destination=new t(a.destination)}return a}();a.GroupMemberConnectionInfo=u;var v=function(a){function b(b,c,d){var e=a.call(this,b,c,d)||this;return e.connectionFailureState=0,e.connectionInfos=[],e.operatingSystemType=0,e.updateProperties(c),e}return __extends(b,a),b.prototype.updateProperties=function(a){if(a&&a.properties&&(a.properties.machineId||a.properties.machine)){if(c.deepCopyAllProperties(a.properties,this),this.displayName=a.properties.displayName||a.name,this.isMonitored=c.isNodeMonitored(a.properties.monitoringState),a.properties.machineId&&(this.machineId=a.properties.machineId.id),this.connectionInfos=[],a.properties.connectionInfos)for(var b=0;b<a.properties.connectionInfos.length;b++){var d=new u(a.properties.connectionInfos[b]);this.connectionInfos.push(d),this.connectionFailureState=Math.max(this.connectionFailureState,d.failureState)}a.properties.osFamily?this.operatingSystemType=k.osFamilyToFamilyType(a.properties.osFamily):this.operatingSystemType=0}},b.prototype.getHealth=function(){return this.isMonitored?2===this.machine.maxBadgeEmphasis?"Warning":3===this.machine.maxBadgeEmphasis?"Critical":"Nominal":"Unknown"},b}(i);a.ClientOrServerGroupMemberMachine=v;var w=function(a){function b(b,c){return a.call(this,b,c,16)||this}return __extends(b,a),b}(v);a.ClientGroupMemberMachine=w;var x=function(a){function b(b,c){return a.call(this,b,c,17)||this}return __extends(b,a),b}(v);a.ServerGroupMemberMachine=x;var y=function(a){function b(b,c,d){var e=a.call(this,b,c,d)||this;return e.filteredMemberCount=0,e.currentPageNumber=0,e.memberCountPerPage=0,e.currentHealthStateFilter="None",e._allMemberGraphNodes={},e._filteredMemberGraphNodes={},e.memberCountPerPage=10,e.currentPageNumber=0,e}return __extends(b,a),b.prototype.addGroupMemberGraphNode=function(a,b){this._allMemberGraphNodes[b]=a,this._filteredMemberGraphNodes[b]=a},b.prototype.getTotalMemberCount=function(){var a=0;for(var b in this._allMemberGraphNodes)a++;return a},b.prototype.getTotalPageCount=function(){var a=0;return a="None"===this.currentHealthStateFilter?this.getTotalMemberCount()/this.memberCountPerPage:this.filteredMemberCount/this.memberCountPerPage,Math.ceil(a)},b.prototype.moveToNextPage=function(){var a=this.getTotalPageCount();this.currentPageNumber<a-1&&(this.currentPageNumber++,this.markCurrentPageMembersAsVisible())},b.prototype.moveToPrevPage=function(){0!==this.currentPageNumber&&(this.currentPageNumber--,this.markCurrentPageMembersAsVisible())},b.prototype.markCurrentPageMembersAsVisible=function(){this.graphNode&&this.graphNode.setProperty("filterChanged",!0);for(var a in this._allMemberGraphNodes)this._allMemberGraphNodes[a].visible=!1;for(var b=this.currentPageNumber*this.memberCountPerPage;b<this.currentPageNumber*this.memberCountPerPage+this.memberCountPerPage;b++)this._filteredMemberGraphNodes[b]&&(this._filteredMemberGraphNodes[b].visible=!0)},b.prototype.clearFilter=function(){this._filteredMemberGraphNodes=this._allMemberGraphNodes,this.currentPageNumber=0,this.filteredMemberCount=this.getTotalMemberCount(),this.markCurrentPageMembersAsVisible(),this.currentHealthStateFilter="None"},b}(i);a.PageableGroupNodeViewModel=y;var z=function(a){function c(b,c,d){var e=a.call(this,b,c,d)||this;return e.monitoredMemberSummaryCount=0,e.discoveredMemberSummaryCount=0,e.name=c.name,e.monitoredMemberMachines={},e.allGroupMembers=[],e}return __extends(c,a),c.prototype.getCriticalMemberCount=function(){return this._getFilteredMemberCount(3)},c.prototype.getWarningMemberCount=function(){return this._getFilteredMemberCount(2)},c.prototype.getMonitoredMemberCount=function(){if(void 0===this._filteredMemberGraphNodes[0])return this.monitoredMemberSummaryCount;var a=0;for(var b in this._allMemberGraphNodes)!0===this._allMemberGraphNodes[b].data.isMonitored&&a++;return a},c.prototype.getDiscoveredMemberCount=function(){if(void 0===this._filteredMemberGraphNodes[0])return this.discoveredMemberSummaryCount;var a=0;for(var b in this._allMemberGraphNodes)!1===this._allMemberGraphNodes[b].data.isMonitored&&a++;return a},c.prototype.getFilteredMemberIds=function(a){void 0===a&&(a=!1);var b=new Array;if(void 0===this._filteredMemberGraphNodes[0])for(var c in this.monitoredMemberMachines){var d=this.monitoredMemberMachines[c];d&&d.id&&b.push(d.id)}else for(var e in this._filteredMemberGraphNodes){var f=this._filteredMemberGraphNodes[e],g=f.data;g&&g.machineId&&g.isMonitored&&(!1===a||g.isMonitored===a)&&b.push(g.machineId)}return b},c.prototype.getNodeSubheader=function(a){var b=this.getMonitoredMemberCount()+this.getDiscoveredMemberCount();return this.isDiscoveredMemberCountEstimated?b+"+ "+a:b+" "+a},c.prototype.addMemberBadge=function(a){for(var b=this.badges,c=!1,d=0,e=b;d<e.length;d++){var f=e[d];if(f.integrationName===a.integrationName&&f.emphasis===a.emphasis){f.count=f.count+a.count,c=!0;break}}c||this.badges.push(a),this.maxBadgeEmphasis=Math.max(this.maxBadgeEmphasis,a.emphasis),this.graphNode.setProperty("statusBadges",this.badges)},c.prototype.applyFilter=function(a){if(this.currentHealthStateFilter===a)return this.clearFilter(),void b.info("User cleared the filter","ClientOrServerGroup","ClearFilter",{filter:this.currentHealthStateFilter.toString(),id:this.id});b.info("User selected the filter","ClientOrServerGroup","ApplyFilter",{filter:this.currentHealthStateFilter.toString(),id:this.id}),this.currentHealthStateFilter=a,this._filteredMemberGraphNodes={};var c=0;for(var d in this._allMemberGraphNodes){this._allMemberGraphNodes[d].data.getHealth()===a&&(this._filteredMemberGraphNodes[c++]=this._allMemberGraphNodes[d])}this.currentPageNumber=0,this.filteredMemberCount=c,this.markCurrentPageMembersAsVisible()},c.prototype.getFilteredClientSummaryText=function(){var a=13===this.type?"Clients:":"Servers:";return"None"===this.currentHealthStateFilter?a+=" All":a=a+" "+this.filteredMemberCount+" of "+this.getTotalMemberCount(),a},c.prototype._getFilteredMemberCount=function(a){var b=0;if(void 0===this._allMemberGraphNodes[0])for(var c in this.monitoredMemberMachines)this.monitoredMemberMachines[c].maxBadgeEmphasis===a&&b++;else for(var d in this._allMemberGraphNodes)this._allMemberGraphNodes[d].data.getHealth()===a&&b++;return b},c}(y);a.GroupViewModelV3=z;var A=function(a){function b(b,c){var d=a.call(this,b,c,14)||this;return d.displayName="Port: "+c.properties.portNumber,d.isMonitored=!0,d.role=0,d.clientEntities={},d.clientGraphNodes={},d}return __extends(b,a),b.prototype.addClient=function(a){!a||0!==a.type&&10!==a.type&&1!==a.type||(this.clientEntities[a.id]=a)},b.prototype.addClientEntityGraphNode=function(a){a&&(this.clientGraphNodes[a.id]=a)},b.prototype.isServerGroupVisible=function(){var a=!1;for(var b in this.clientGraphNodes)a=a||this.clientGraphNodes[b].visible;return a},b}(z);a.ServerGroupViewModelV3=A;var B=function(a){function b(b,d){var e=a.call(this,b,d,13)||this;return e.displayName="Clients Group",e.isMonitored=!0,e.role=0,d.properties.clientsOf&&(e.destinationId=c.getArmEntityId(d.properties.clientsOf)),e.destination=null,e}return __extends(b,a),b.prototype.setDestinationEntity=function(a){this.destination=a},b}(z);a.ClientGroupViewModelV3=B;var C=function(a){function c(b,c,d){var e=a.call(this,b,void 0,20)||this;return e.currentHealthStateFilter="None",e.machines=d,e.id=b,e.displayName=c,e.isMonitored=!0,e.selfLinksVisible=!1,e.totalMachineCount=d&&d.length,e}return __extends(c,a),c.prototype.getCriticalMemberCount=function(){var a=0;for(var b in this._allMemberGraphNodes)"Critical"===this._allMemberGraphNodes[b].data.getHealth()&&a++;return a},c.prototype.applyFilter=function(a){if(this.currentHealthStateFilter===a)return this.clearFilter(),void b.info("User cleared the filter","ClientOrServerGroup","ClearFilter",{filter:this.currentHealthStateFilter.toString(),id:this.id});b.info("User selected the filter","ClientOrServerGroup","ApplyFilter",{filter:this.currentHealthStateFilter.toString(),id:this.id}),this.currentHealthStateFilter=a,this._filteredMemberGraphNodes={};var c=0;for(var d in this._allMemberGraphNodes){this._allMemberGraphNodes[d].data.getHealth()===a&&(this._filteredMemberGraphNodes[c++]=this._allMemberGraphNodes[d])}this.currentPageNumber=0,this.filteredMemberCount=c,this.markCurrentPageMembersAsVisible()},c}(y);a.VirtualGroupNodeViewModel=C;var D=function(a){function b(b,c){var d=a.call(this,b,c,12)||this;return d.connections=[],d.displayName="Connection",d.clients=c.properties.clients,d.servers=c.properties.servers,d.portIds=c.properties.portIds,d}return __extends(b,a),b}(j);a.AggConnection=D;var E=function(a){function b(b,c,d){var e=this,f={id:b,type:"Microsoft.OperationalInsights/workspaces/features/connections",kind:"rel:connection",name:""};return e=a.call(this,b,f,18)||this,e.source=c.machineId,e.destination=d.id,e.clientGroupMember=c,e.destinationNode=d,e.failureState=c.connectionFailureState,e}return __extends(b,a),b}(j);a.ClientGroupMemberVirtualConnection=E;var F=function(a){function b(b,c,d){var e=this,f={id:b,type:"Microsoft.OperationalInsights/workspaces/features/connections",kind:"rel:connection",name:""};return e=a.call(this,b,f,19)||this,e.source=c.id,e.destination=d.machineId,e.serverGroupMember=d,e.sourceNode=c,e.failureState=d.connectionFailureState,e}return __extends(b,a),b}(j);a.ServerGroupMemberVirtualConnection=F;var G=function(a){function b(d,e){var f=a.call(this,d,e,3)||this;return f.displayName="Connection",f.source=c.getArmEntityId(e.properties.source),f.destination=c.getArmEntityId(e.properties.destination),e.properties.serverPort&&(f.serverPort=c.getArmEntityId(e.properties.serverPort)),f.failureState=b.getFailureState(e.properties.failureState),f.isSelfLink=!1,f}return __extends(b,a),b.getFailureState=function(a){if(!a)return 0;switch(a.toLowerCase()){case"failed":return 1;case"mixed":return 2;case"ok":default:return 0}},b}(j);a.Connection=G;var H=function(a){function b(b,d){var e=a.call(this,b,d,4)||this;return e.source=c.getArmEntityId(d.properties.source),e.destination=c.getArmEntityId(d.properties.destination),e}return __extends(b,a),b}(e);a.Acceptor=H}(DependencyMap||(DependencyMap={}));var DependencyMap;!function(a){"use strict";var b=function(){function a(){}return a.GetQueryResultObjects=function(b,c,d){if(void 0===c&&(c=!0),void 0===d&&(d=0),null==b||b.Tables.length<=d)return null;var e=b.Tables[d];return a.convertKustoResultsToObjects(e.Rows,e.Columns,c)},a.convertKustoResultsToObjects=function(a,b,c){if(!a||!b)return null;for(var d=[],e=b.length,f=0;f<a.length;f++){for(var g={},h=0;h<e;h++){var i=a[f][h];c&&null==i||(g[b[h].ColumnName]=i)}c&&$.isEmptyObject(g)||d.push(g)}return d},a}();a.KustoUtils=b}(DependencyMap||(DependencyMap={}));var DependencyMap;!function(a){"use strict";var b=a.TelemetryProvider,c=function(){function c(){}return c.addAlertBadges=function(c,d){if(c){var e=a.AdmWorkspace.getMapInstance();if(!e)return void b.error("mapInstance is undefined","AdmAlertsManager","addAlertBadges");var f=this.convertKustoResultToAlerts(c),g=this.convertToBadge(d,f);e.addNodeBadges(g)}},c.generateQuery=function(a,d){try{var e=moment.utc(a).toISOString();return"Alert | where isnotempty(Computer) | where QueryExecutionStartTime <= datetime('"+moment.utc(d).toISOString()+"') | where QueryExecutionEndTime >= datetime('"+e+"')"}catch(a){return b.error(a,c.NAME,"generateQuery",null,{message:"Failed to Generate Alter Query"}),null}},c.generateQueryInSearchBlade=function(a){return"Alert | where AlertRuleInstanceId == '"+a+"'"},c.convertKustoResultToAlerts=function(b){for(var c=a.KustoUtils.GetQueryResultObjects(b),d={},e=0,f=c;e<f.length;e++){var g=f[e],h=void 0;g.Computer&&(h=g.Computer.toLocaleLowerCase().trim()),h&&(g.severityLevel=this.getSeverityLevel(g),g.formattedQueryTimeGeneated=this.formatDate(g.TimeGenerated),g.formattedQueryExecutionStartTime=this.formatDate(g.QueryExecutionStartTime),g.formattedQueryExecutionEndTime=this.formatDate(g.QueryExecutionEndTime),d.hasOwnProperty(h)||(d[h]=[]),d[h].push(g))}return d},c.convertToBadge=function(b,c){if(!c||!b)return null;var d=[];for(var e in c)!function(e){var f=c[e],g=b[e];if(f&&g){var h=0;f.forEach(function(a){h=Math.max(h,a.severityLevel)});var i=void 0;switch(h){case 3:i="url('"+a.AdmGraphWidget.MapImagesRelativePath+"integrations/alerts_red.svg')";break;case 2:i="url('"+a.AdmGraphWidget.MapImagesRelativePath+"integrations/alerts_yellow.svg')";break;case 1:default:i="url('"+a.AdmGraphWidget.MapImagesRelativePath+"integrations/alerts_blue.svg')"}d.push({integrationId:g,integrationName:"Alert",emphasis:h,icon:i,count:f.length})}}(e);return d},c.getSeverityLevel=function(a){if(!a||!a.AlertSeverity)return 0;switch(a.AlertSeverity.toLowerCase()){case"critical":return 3;case"warning":return 2;case"informational":return 1;default:return b.debug("Unsupported alert level",c.NAME,"getSeverityLevel"),1}},c.NAME="AdmAlertsManager",c.formatDate=function(a){try{return a?moment(a).local().format("ddd MMM D H:mm:ss z Y"):""}catch(d){return b.error(d,c.NAME,"formateDate",null,{date:a&&JSON.stringify(a)}),""}},c}();a.AdmAlertsManager=c}(DependencyMap||(DependencyMap={}));var DependencyMap;!function(a){"use strict";var b=a.TelemetryProvider,c=function(){function c(){}return c.convertKustoResponseToLogEvents=function(b){return a.KustoUtils.GetQueryResultObjects(b)},c.generateQuery=function(a,d,e){
try{var f=moment.utc(d).toISOString();return"search Computer == '"+a+"' | where TimeGenerated <= datetime('"+moment.utc(e).toISOString()+"') | where TimeGenerated >= datetime('"+f+"') | extend Type = $table  | summarize AggregatedValue = count() by Type | order by Type asc"}catch(a){return b.error(a,c.NAME,"generateQuery",null,{message:"Failed to Generate Alter Query"}),null}},c.generateQueryInSearchBlade=function(a,b){return a.Type+" | where Computer == '"+b+"'"},c.NAME="AdmAlertsManager",c}();a.AdmLogEventsManager=c}(DependencyMap||(DependencyMap={}));