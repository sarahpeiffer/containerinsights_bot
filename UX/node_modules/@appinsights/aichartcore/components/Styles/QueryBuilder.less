@import 'Common/Color.less';
@import 'Common/Mixins.less';
@import '../../Ibiza/Text.less';
@import '~@appinsights/react-select/less/default.less';

/* VARIABLES */
@resource-dropdown-width: 394px;
@namespace-dropdown-width: 400px;
@metric-dropdown-width: 300px;

/* ELEMENTS */
.query-builder {
  /* this is to ensure collapsing works when clicking on the right hand of the query builder */
  display: inline-block;
  position: relative;
  margin-bottom: 10px;

  .aim-pillcontainer {
    display: inline;
    margin: 5px 0;

    .aim-pill {
      .aim-footer {
        .fx-text-internal(regular, 12px, 14px);

        #TimeRangeSelection {
          color: @primary-selected-light-button;
        }
      }

      .Select.aim-metric-resource {
        .headermenu {
          .Select-menu-outer {
            width: 300px;
          }

          .selector.type-selection {
            .Select-menu-outer {
              width: 250px;
            }
          }
        }

        .Select-option {
          .resource-option {
            display: flex;
            
            .resource-option-left {
              flex: 1 0 200px;

              .custom-option-label.resource-label {
                max-width: 90%;
              }
            }
          }

          .value-with-check {
            display: flex;

            input[type=checkbox] {
              margin-left: 0;
            }
            
            .value {
              flex: 1 1 100%;
            }
          }
          
          .rg-option {
            display: flex;
            flex-direction: column;
            align-items: flex-start;

            .rg-label {
              .ellipsify(true);
            }

            .additional-qualifier {
              margin-left: 0;
              width: 100%;
              .ellipsify(true);
            }
          }
        }
      }

      .metric {
        font-weight: bold;
        .fx-font-bold();
      }
    }
  }

  .aim-pill {
    .aim-pill-pickers {
      .aim-metric-namespace {
        .Select-menu-outer {
          width: @namespace-dropdown-width !important;
        }
      }
    }

    .aim-pill-icon {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-left: 4px;
    }

    .dropdown-label {
      .fx-text-internal(regular, 8px, 8px);

      text-transform: uppercase;
      color: @color-text;
      display: block;
      padding: 0 2px 2px;
    }
  }

  .color-metric {
    .colored-element(@color-metric);

    .metric:not(.Select) {
      font-weight: bold;
      .fx-font-bold();
    }
  }

  .color-filter {
    .colored-element(@color-filter);

    .aim-pill-icon svg {
      height: 13px;
      width: 13px;
    }
  }

  .color-grouping {
    .colored-element(@color-grouping);

    .aim-pill-icon svg {
      height: 16px;
      width: 16px;
    }
  }
}

.namespace-additional-content-wrapper {
  .fx-text-internal(regular, 12px, 14px);
  
  display: flex;
  flex-direction: column;
  margin-bottom: 2px;

  .namespace-additional-content-toggle {
    display: inline-flex;
    margin-bottom: 2px;

    .toggleLabel {
      margin-left: 5px;
      align-self: center;
    }
  }

  .namespace-additional-content-learn-more {
    display: inline-flex;
    align-self: center;

    a {
      text-decoration: none;
      color: @primary-selected-light-button;
    }
    
    a:hover {
      text-decoration: underline;
    }

    svg {
      height: 9px;
      width: 9px;
      align-self: flex-end;
      padding-left: 4px;
      padding-bottom: 1px;
    }
    
    svg:hover {
      cursor: pointer;
    }
  }
}

.aim-pillcontainer {
  display: flex;

  .aim-pill {
    margin: 5px 7px 5px 0;

    &.hide {
      visibility: 'none';
    }

    &.error {
      .Select {
        .Select-option {
          &.is-disabled {
            text-transform: none;
            padding: 7px;
            width: 160px;
          }
        }
      }
    }

    .Select {
      .fx-text-regular();

      // Set widths for various dropdown items
      &.resource,
      &.metric,
      &.dimension,
      &.values {
        .Select-control {
          width: 160px;
        }

        .Select-input {
          max-width: 125px;
        }
      }

      &.resource {
        .Select-menu-outer {
          width: @resource-dropdown-width;
        }
      }

      &.metric {
        .Select-menu-outer {
          width: @metric-dropdown-width;
        }
      }

      &.dimension,
      &.values {
        .Select-menu-outer {
          width: 200px;
        }
      }

      &.groupby {
        .Select-control {
          width: 180px;
        }

        .Select-input {
          max-width: 125px;
        }

        .Select-menu-outer {
          width: 200px;
        }
      }

      &.aggregation {
        .Select-control {
          width: 80px;
        }

        .Select-input {
          max-width: 45px;
        }
      }

      &.subcontainer {
        visibility: none;

        .Select-control {
          width: 86px;
        }

        .Select-input {
          max-width: 45px;
        }
      }

      &.operator {
        .Select-control {
          width: 57px;
          margin-top: 10px;
        }

        .Select-input,
        .Select-value {
          text-overflow: clip !important;
        }

        .Select-input {
          max-width: 10px;
        }
      }

      &.values {
        .Select-option {
          padding: 3px 4px;
        }
      }

      &.error {
        .Select-menu-outer {
          width: 160px;
          height: 110px;
        }

        .error-option {
          display: flex;
          align-items: center;
          justify-content: space-between;

          .error-option-left {
            display: flex;

            .error-icon-container {
              margin-right: 8px;

              > svg {
                height: 10px;
                width: 11px;
              }
            }

            .error-label {
              .ellipsify(false);

              max-width: 125px;
              line-height: 14px;
              font-size: 10px;
              font-family: "Segoe UI", Tahoma, Arial, sans-serif;
              color: @color-text;
              word-break: break-word;
              white-space: normal;

              &.error-value {
                margin-top: 6px;
                word-break: break-all;
              }
            }

            .error-option-right {
              padding: 0 2px 0 0;
            }
          }
        }
      }

      &.multiselect {
        .Select-option {
          padding: 4px 13px 4px 6px;
        }
      }

      .Select-noresults {
        padding: 6px 8px;
        height: 26px;
      }

      // Style the dropdown controls
      .Select-control {
        height: 25px;
        border-radius: 0;
        border: 1px solid @color-border;

        .Select-multi-value-wrapper,
        .Select-value,
        .Select-input,
        .Select-placeholder {
          height: 22px;
          line-height: 22px;
          padding-left: 8px;
          padding-top: 1px;
          color: @color-text;
        }

        .Select-value {
          padding-right: 25px;
        }

        .Select-placeholder {
          font-style: italic;
        }

        .Select-input {
          .ellipsify(true);

          position: relative;
          top: -5px;
          left: -8px;
          margin-left: 0;
        }

        .icon-dropdown-search {
          position: relative;
          top: 2px;
          width: 20px;
          height: 14px;
        }

        .Select-arrow {
          border-top-color: @color-text;
        }
      }

      // Styles the disabled control
      &.is-disabled {
        .Select-control {
          background-color: #e6e6e5;

          .Select-multi-value-wrapper,
          .Select-value,
          .Select-input,
          .Select-placeholder {
            height: 22px;
            line-height: 22px;
            color: @color-text-disabled;
          }
        }
      }

      // Style the dropdown options
      .Select-option {
        .ellipsify(true);

        max-width: 100%;
        padding: 4px 10px;
        color: @color-text;

        // Categories are implemented as disabled items
        &.is-disabled {
          .fx-font-semibold();

          cursor: default;
          padding: 6px 8px 4px;
          text-transform: uppercase;

          &:not(:first-child) {
            border-top: 1px solid @color-border;
            margin-top: 6px;
          }

          .intro-text,
          .no-results-found {
            .fx-font();

            text-transform: none;
          }

          .no-results-found {
            color: #999;
          }
        }

        .custom-option {
          display: flex;
          align-items: center;

          .custom-option-icon-container {
            margin-right: 6px;
            padding-top: 2px;

            > svg {
              height: 14px;
              width: 14px;
            }
          }

          .custom-option-label {
            .ellipsify(true);

            max-width: 200px;
          }
        }

        .namespace-option {
          &.namespace-learnmore {
            text-transform: none;

            a,
            a:hover,
            a:active,
            a:visited,
            a:focus {
              color: @primary-selected-light-button;
              text-decoration: none;
            }
          }

          .namespace-option-left {
            display: flex;
          }

          .namespace-resource-type {
            margin-left: 20px;
            text-transform: lowercase;
          }
        }

        .resource-option {
          justify-content: space-between;

          &.is-disabled {
            margin-top: -6px;
            cursor: default;
            font-family: "Segoe UI", Tahoma, Arial, sans-serif;
            text-transform: none;
          }

          .resource-option-left {
            display: flex;
          }

          .resource-type {
            .fx-text-internal(regular, 10px, 12px);
            .ellipsify(true);

            margin-left: 4px;
            text-transform: uppercase;
          }
        }

        .additional-qualifier {
          margin-left: 20px;
          color: @color-text-disabled;
        }

        .value-with-check {
          display: flex;

          input[type=checkbox] {
            flex: 0 0 auto;
          }

          .value {
            .ellipsify(true);
          }
        }
      }

      #classicMetricInfoBalloon {
        max-width: 10px;
        max-height: 10px;
        margin-left: 5px;
        margin-top: 1px;
      }

      // Force dropdown menu to appear left-most
      .Select-menu-outer {
        left: 0;
      }
    }
  }
}

.dark {
  .query-builder {
    .aim-pillcontainer {
      .aim-pill {
        .Select {
          &.has-value.Select--single > .Select-control .Select-value .Select-value-label,
          .Select-control .Select-placeholder,
          .Select-input input,
          .Select-option {
            color: white;
          }

          &.is-disabled {
            .Select-control {
              background-color: @color-background-disabled-dark;
              border-color: rgba(127, 127, 127, 0.7);
            }
          }
        }

        .aim-footer {
          #TimeRangeSelection {
            color: @primary-selected-dark-button;
          }
        }

        .namespace-additional-content-learn-more {
          a {
            color: @primary-selected-dark-button;
          }
        }
      }
    }

    .color-metric {
      .colored-element(@color-metric-dark);
    }
  
    .color-filter {
      .colored-element(@color-filter-dark);
    }
  
    .color-grouping {
      .colored-element(@color-grouping-dark);
    }
  }
}

@media screen and (-ms-high-contrast: black-on-white) {
  .light.high-contrast;
  .hc-ie(@highcontrast-light-fg);
}

@media screen and (-ms-high-contrast: white-on-black) {
  .dark.high-contrast;
  .hc-ie(@highcontrast-dark-fg);
}

.light.high-contrast {
  .hc(@highcontrast-light-bg, @highcontrast-light-fg, @highcontrast-light-bgSelect, @highcontrast-light-fgSelect, @highcontrast-light-disabled, @highcontrast-light-link);
}

.dark.high-contrast {
  .hc(@highcontrast-dark-bg, @highcontrast-dark-fg, @highcontrast-dark-bgSelect, @highcontrast-dark-fgSelect, @highcontrast-dark-disabled, @highcontrast-dark-link);
}

.hc(@bg, @fg, @bgSelect, @fgSelect, @disabled, @link) {
  .query-builder .aim-pillcontainer .aim-pill {
    .resource-button.overlay-selected {
      background-color: @fgSelect;
      border-color: @bgSelect;
      color: @bgSelect;

      svg path {
        stroke: @bgSelect;
      }
    }

    .aim-footer #TimeRangeSelection {
      color: @link;
    }

    .Select {
      .Select-option {
        color: @fg;

        &.is-focused,
        &.is-selected,
        :hover {
          background-color: @bgSelect;
          color: @fgSelect;

          .additional-qualifier {
            color: @fgSelect;
          }
        }

        .additional-qualifier {
          color: @fg;
        }
      }

      .Select-control {
        .Select-multi-value-wrapper,
        .Select-value .Select-value-label,
        .Select-input,
        .Select-placeholder {
          color: @fg;
        }
      }

      &.is-open > .Select-control {
        .Select-multi-value-wrapper,
        .Select-value .Select-value-label,
        .Select-input,
        .Select-placeholder {
          color: @bgSelect;
        }
      }

      &.is-disabled {
        .Select-control {
          background-color: @bg;
          border-color: @disabled;

          .Select-multi-value-wrapper,
          .Select-value .Select-value-label,
          .Select-input,
          .Select-option,
          .Select-placeholder {
            color: @disabled;
          }
        }
      }
    }
  }
}

.hc-ie(@fg) {
  .query-builder .aim-pillcontainer .aim-pill {
    .aim-pill-pickers .aim-pill-dropdown-with-labels label,
    .selector-label {
      color: @fg;
    }

    .Select {
      .Select-option {
        &.is-focused,
        &.is-selected,
        :hover {
          color: @fg;

          .additional-qualifier {
            color: @fg;
          }
        }
      }
    }
  }
}

/* MIXINS */
.colored-element(@color) {
  .aim-pill {
    &:not(.aim-disabled) {
      &:not(.aim-pill-editing) {
        color: @color;
      }

      &:not(.resource-icon) .aim-pill-icon svg {
        circle,
        polygon,
        path {
          fill: @color;
        }

        line,
        polygon:not(.close) {
          stroke: @color;
        }

        line {
          stroke-width: 1.5;
          stroke-miterlimit: 10;
        }
      }
    }

    &.aim-disabled {
      color: @color-disabled;

      &:not(.resource-icon) .aim-pill-icon svg {
        circle,
        polygon,
        path {
          fill: @color-disabled;
        }

        line,
        polygon:not(.close) {
          stroke: @color-disabled;
        }

        line {
          stroke-width: 1.5;
          stroke-miterlimit: 10;
        }
      }
    }
  }
}
