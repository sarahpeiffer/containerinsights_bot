"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
Object.defineProperty(exports, "DirectLineStreaming", {
  enumerable: true,
  get: function get() {
    return _directLineStreaming.DirectLineStreaming;
  }
});
exports.DirectLine = exports.ConnectionStatus = void 0;

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

require("core-js/features/promise");

require("url-search-params-polyfill");

var _BehaviorSubject = require("rxjs/BehaviorSubject");

var _Observable = require("rxjs/Observable");

var _async = require("rxjs/scheduler/async");

require("rxjs/add/operator/catch");

require("rxjs/add/operator/combineLatest");

require("rxjs/add/operator/count");

require("rxjs/add/operator/delay");

require("rxjs/add/operator/do");

require("rxjs/add/operator/filter");

require("rxjs/add/operator/map");

require("rxjs/add/operator/mergeMap");

require("rxjs/add/operator/concatMap");

require("rxjs/add/operator/retryWhen");

require("rxjs/add/operator/share");

require("rxjs/add/operator/take");

require("rxjs/add/observable/dom/ajax");

require("rxjs/add/observable/empty");

require("rxjs/add/observable/from");

require("rxjs/add/observable/interval");

require("rxjs/add/observable/of");

require("rxjs/add/observable/throw");

var _dedupeFilenames = _interopRequireDefault(require("./dedupeFilenames"));

var _directLineStreaming = require("./directLineStreaming");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var DIRECT_LINE_VERSION = 'DirectLine/3.0';
// These types are specific to this client library, not to Direct Line 3.0
var ConnectionStatus;
exports.ConnectionStatus = ConnectionStatus;

(function (ConnectionStatus) {
  ConnectionStatus[ConnectionStatus["Uninitialized"] = 0] = "Uninitialized";
  ConnectionStatus[ConnectionStatus["Connecting"] = 1] = "Connecting";
  ConnectionStatus[ConnectionStatus["Online"] = 2] = "Online";
  ConnectionStatus[ConnectionStatus["ExpiredToken"] = 3] = "ExpiredToken";
  ConnectionStatus[ConnectionStatus["FailedToConnect"] = 4] = "FailedToConnect";
  ConnectionStatus[ConnectionStatus["Ended"] = 5] = "Ended";
})(ConnectionStatus || (exports.ConnectionStatus = ConnectionStatus = {}));

var wrapAjaxWithRetry = function wrapAjaxWithRetry(source, scheduler) {
  var notImplemented = function notImplemented() {
    throw new Error('not implemented');
  };

  var inner = function inner(response$) {
    return response$["catch"](function (err) {
      if (err.status === 429) {
        var retryAfterValue = err.xhr.getResponseHeader('Retry-After');
        var retryAfter = Number(retryAfterValue);

        if (!isNaN(retryAfter)) {
          return _Observable.Observable.timer(retryAfter, scheduler).flatMap(function (_) {
            return _Observable.Observable["throw"](err, scheduler);
          });
        }
      }

      return _Observable.Observable["throw"](err, scheduler);
    });
  };

  var outer = function outer(urlOrRequest) {
    return inner(source(urlOrRequest));
  };

  return Object.assign(outer, {
    get: function get(url, headers) {
      return notImplemented();
    },
    post: function post(url, body, headers) {
      return notImplemented();
    },
    put: function put(url, body, headers) {
      return notImplemented();
    },
    patch: function patch(url, body, headers) {
      return notImplemented();
    },
    "delete": function _delete(url, headers) {
      return notImplemented();
    },
    getJSON: function getJSON(url, headers) {
      return notImplemented();
    }
  });
};

var makeServices = function makeServices(services) {
  var scheduler = services.scheduler || _async.async;
  return {
    scheduler: scheduler,
    ajax: wrapAjaxWithRetry(services.ajax || _Observable.Observable.ajax, scheduler),
    WebSocket: services.WebSocket || WebSocket,
    random: services.random || Math.random
  };
};

var lifetimeRefreshToken = 30 * 60 * 1000;
var intervalRefreshToken = lifetimeRefreshToken / 2;
var POLLING_INTERVAL_LOWER_BOUND = 200; //ms

var errorExpiredToken = new Error("expired token");
var errorConversationEnded = new Error("conversation ended");
var errorFailedToConnect = new Error("failed to connect");
var konsole = {
  log: function log(message) {
    var _console;

    for (var _len = arguments.length, optionalParams = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      optionalParams[_key - 1] = arguments[_key];
    }

    if (typeof window !== 'undefined' && window["botchatDebug"] && message) (_console = console).log.apply(_console, [message].concat(optionalParams));
  }
};

var DirectLine =
/*#__PURE__*/
function () {
  //ms
  function DirectLine(options) {
    (0, _classCallCheck2["default"])(this, DirectLine);
    (0, _defineProperty2["default"])(this, "connectionStatus$", new _BehaviorSubject.BehaviorSubject(ConnectionStatus.Uninitialized));
    (0, _defineProperty2["default"])(this, "activity$", void 0);
    (0, _defineProperty2["default"])(this, "domain", "https://directline.botframework.com/v3/directline");
    (0, _defineProperty2["default"])(this, "webSocket", void 0);
    (0, _defineProperty2["default"])(this, "conversationId", void 0);
    (0, _defineProperty2["default"])(this, "expiredTokenExhaustion", void 0);
    (0, _defineProperty2["default"])(this, "secret", void 0);
    (0, _defineProperty2["default"])(this, "token", void 0);
    (0, _defineProperty2["default"])(this, "watermark", '');
    (0, _defineProperty2["default"])(this, "streamUrl", void 0);
    (0, _defineProperty2["default"])(this, "_botAgent", '');
    (0, _defineProperty2["default"])(this, "services", void 0);
    (0, _defineProperty2["default"])(this, "_userAgent", void 0);
    (0, _defineProperty2["default"])(this, "referenceGrammarId", void 0);
    (0, _defineProperty2["default"])(this, "botIdHeader", void 0);
    (0, _defineProperty2["default"])(this, "timeout", 20 * 1000);
    (0, _defineProperty2["default"])(this, "retries", void 0);
    (0, _defineProperty2["default"])(this, "pollingInterval", 1000);
    (0, _defineProperty2["default"])(this, "tokenRefreshSubscription", void 0);
    this.secret = options.secret;
    this.token = options.secret || options.token;
    this.webSocket = (options.webSocket === undefined ? true : options.webSocket) && typeof WebSocket !== 'undefined' && WebSocket !== undefined;

    if (options.domain) {
      this.domain = options.domain;
    }

    if (options.conversationId) {
      this.conversationId = options.conversationId;
    }

    if (options.watermark) {
      this.watermark = options.watermark;
    }

    if (options.streamUrl) {
      if (options.token && options.conversationId) {
        this.streamUrl = options.streamUrl;
      } else {
        console.warn('DirectLineJS: streamUrl was ignored: you need to provide a token and a conversationid');
      }
    }

    if (options.timeout !== undefined) {
      this.timeout = options.timeout;
    }

    this.retries = (lifetimeRefreshToken - intervalRefreshToken) / this.timeout;
    this._botAgent = this.getBotAgent(options.botAgent);
    this.services = makeServices(options);
    var parsedPollingInterval = ~~options.pollingInterval;

    if (parsedPollingInterval < POLLING_INTERVAL_LOWER_BOUND) {
      if (typeof options.pollingInterval !== 'undefined') {
        console.warn("DirectLineJS: provided pollingInterval (".concat(options.pollingInterval, ") is under lower bound (200ms), using default of 1000ms"));
      }
    } else {
      this.pollingInterval = parsedPollingInterval;
    }

    this.expiredTokenExhaustion = this.setConnectionStatusFallback(ConnectionStatus.ExpiredToken, ConnectionStatus.FailedToConnect, 5);
    this.activity$ = (this.webSocket ? this.webSocketActivity$() : this.pollingGetActivity$()).share();
  } // Every time we're about to make a Direct Line REST call, we call this first to see check the current connection status.
  // Either throws an error (indicating an error state) or emits a null, indicating a (presumably) healthy connection


  (0, _createClass2["default"])(DirectLine, [{
    key: "checkConnection",
    value: function checkConnection() {
      var _this = this;

      var once = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      var obs = this.connectionStatus$.flatMap(function (connectionStatus) {
        if (connectionStatus === ConnectionStatus.Uninitialized) {
          _this.connectionStatus$.next(ConnectionStatus.Connecting); //if token and streamUrl are defined it means reconnect has already been done. Skipping it.


          if (_this.token && _this.streamUrl) {
            _this.connectionStatus$.next(ConnectionStatus.Online);

            return _Observable.Observable.of(connectionStatus, _this.services.scheduler);
          } else {
            return _this.startConversation()["do"](function (conversation) {
              _this.conversationId = conversation.conversationId;
              _this.token = _this.secret || conversation.token;
              _this.streamUrl = conversation.streamUrl;
              _this.referenceGrammarId = conversation.referenceGrammarId;
              if (!_this.secret) _this.refreshTokenLoop();

              _this.connectionStatus$.next(ConnectionStatus.Online);
            }, function (error) {
              _this.connectionStatus$.next(ConnectionStatus.FailedToConnect);
            }).map(function (_) {
              return connectionStatus;
            });
          }
        } else {
          return _Observable.Observable.of(connectionStatus, _this.services.scheduler);
        }
      }).filter(function (connectionStatus) {
        return connectionStatus != ConnectionStatus.Uninitialized && connectionStatus != ConnectionStatus.Connecting;
      }).flatMap(function (connectionStatus) {
        switch (connectionStatus) {
          case ConnectionStatus.Ended:
            return _Observable.Observable["throw"](errorConversationEnded, _this.services.scheduler);

          case ConnectionStatus.FailedToConnect:
            return _Observable.Observable["throw"](errorFailedToConnect, _this.services.scheduler);

          case ConnectionStatus.ExpiredToken:
            return _Observable.Observable.of(connectionStatus, _this.services.scheduler);

          default:
            return _Observable.Observable.of(connectionStatus, _this.services.scheduler);
        }
      });
      return once ? obs.take(1) : obs;
    }
  }, {
    key: "setConnectionStatusFallback",
    value: function setConnectionStatusFallback(connectionStatusFrom, connectionStatusTo) {
      var maxAttempts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 5;
      maxAttempts--;
      var attempts = 0;
      var currStatus = null;
      return function (status) {
        if (status === connectionStatusFrom && currStatus === status && attempts >= maxAttempts) {
          attempts = 0;
          return connectionStatusTo;
        }

        attempts++;
        currStatus = status;
        return status;
      };
    }
  }, {
    key: "expiredToken",
    value: function expiredToken() {
      var connectionStatus = this.connectionStatus$.getValue();
      if (connectionStatus != ConnectionStatus.Ended && connectionStatus != ConnectionStatus.FailedToConnect) this.connectionStatus$.next(ConnectionStatus.ExpiredToken);
      var protectedConnectionStatus = this.expiredTokenExhaustion(this.connectionStatus$.getValue());
      this.connectionStatus$.next(protectedConnectionStatus);
    }
  }, {
    key: "startConversation",
    value: function startConversation() {
      var _this2 = this;

      //if conversationid is set here, it means we need to call the reconnect api, else it is a new conversation
      var url = this.conversationId ? "".concat(this.domain, "/conversations/").concat(this.conversationId, "?watermark=").concat(this.watermark) : "".concat(this.domain, "/conversations");
      var method = this.conversationId ? "GET" : "POST";
      return this.services.ajax({
        method: method,
        url: url,
        timeout: this.timeout,
        headers: _objectSpread({
          "Accept": "application/json"
        }, this.commonHeaders())
      }) //      .do(ajaxResponse => konsole.log("conversation ajaxResponse", ajaxResponse.response))
      .map(function (ajaxResponse) {
        try {
          if (!_this2.botIdHeader) {
            _this2.botIdHeader = ajaxResponse.xhr.getResponseHeader('x-ms-bot-id');
          }
        } catch (_unused) {
          /*don't care if the above throws for any reason*/
        }

        return ajaxResponse.response;
      }).retryWhen(function (error$) {
        return (// for now we deem 4xx and 5xx errors as unrecoverable
          // for everything else (timeouts), retry for a while
          error$.mergeMap(function (error) {
            return error.status >= 400 && error.status < 600 ? _Observable.Observable["throw"](error, _this2.services.scheduler) : _Observable.Observable.of(error, _this2.services.scheduler);
          }).delay(_this2.timeout, _this2.services.scheduler).take(_this2.retries)
        );
      });
    }
  }, {
    key: "refreshTokenLoop",
    value: function refreshTokenLoop() {
      var _this3 = this;

      this.tokenRefreshSubscription = _Observable.Observable.interval(intervalRefreshToken, this.services.scheduler).flatMap(function (_) {
        return _this3.refreshToken();
      }).subscribe(function (token) {
        konsole.log("refreshing token", token, "at", new Date());
        _this3.token = token;
      });
    }
  }, {
    key: "refreshToken",
    value: function refreshToken() {
      var _this4 = this;

      return this.checkConnection(true).flatMap(function (_) {
        return _this4.services.ajax({
          method: "POST",
          url: "".concat(_this4.domain, "/tokens/refresh"),
          timeout: _this4.timeout,
          headers: _objectSpread({}, _this4.commonHeaders())
        }).map(function (ajaxResponse) {
          return ajaxResponse.response.token;
        }).retryWhen(function (error$) {
          return error$.mergeMap(function (error) {
            if (error.status === 403) {
              // if the token is expired there's no reason to keep trying
              _this4.expiredToken();

              return _Observable.Observable["throw"](error, _this4.services.scheduler);
            } else if (error.status === 404) {
              // If the bot is gone, we should stop retrying
              return _Observable.Observable["throw"](error, _this4.services.scheduler);
            }

            return _Observable.Observable.of(error, _this4.services.scheduler);
          }).delay(_this4.timeout, _this4.services.scheduler).take(_this4.retries);
        });
      });
    }
  }, {
    key: "reconnect",
    value: function reconnect(conversation) {
      this.token = conversation.token;
      this.streamUrl = conversation.streamUrl;
      if (this.connectionStatus$.getValue() === ConnectionStatus.ExpiredToken) this.connectionStatus$.next(ConnectionStatus.Online);
    }
  }, {
    key: "end",
    value: function end() {
      if (this.tokenRefreshSubscription) this.tokenRefreshSubscription.unsubscribe();

      try {
        this.connectionStatus$.next(ConnectionStatus.Ended);
      } catch (e) {
        if (e === errorConversationEnded) return;
        throw e;
      }
    }
  }, {
    key: "getSessionId",
    value: function getSessionId() {
      var _this5 = this;

      // If we're not connected to the bot, get connected
      // Will throw an error if we are not connected
      konsole.log("getSessionId");
      return this.checkConnection(true).flatMap(function (_) {
        return _this5.services.ajax({
          method: "GET",
          url: "".concat(_this5.domain, "/session/getsessionid"),
          withCredentials: true,
          timeout: _this5.timeout,
          headers: _objectSpread({
            "Content-Type": "application/json"
          }, _this5.commonHeaders())
        }).map(function (ajaxResponse) {
          if (ajaxResponse && ajaxResponse.response && ajaxResponse.response.sessionId) {
            konsole.log("getSessionId response: " + ajaxResponse.response.sessionId);
            return ajaxResponse.response.sessionId;
          }

          return '';
        })["catch"](function (error) {
          konsole.log("getSessionId error: " + error.status);
          return _Observable.Observable.of('', _this5.services.scheduler);
        });
      })["catch"](function (error) {
        return _this5.catchExpiredToken(error);
      });
    }
  }, {
    key: "postActivity",
    value: function postActivity(activity) {
      var _this6 = this;

      // Use postMessageWithAttachments for messages with attachments that are local files (e.g. an image to upload)
      // Technically we could use it for *all* activities, but postActivity is much lighter weight
      // So, since WebChat is partially a reference implementation of Direct Line, we implement both.
      if (activity.type === "message" && activity.attachments && activity.attachments.length > 0) return this.postMessageWithAttachments(activity); // If we're not connected to the bot, get connected
      // Will throw an error if we are not connected

      konsole.log("postActivity", activity);
      return this.checkConnection(true).flatMap(function (_) {
        return _this6.services.ajax({
          method: "POST",
          url: "".concat(_this6.domain, "/conversations/").concat(_this6.conversationId, "/activities"),
          body: activity,
          timeout: _this6.timeout,
          headers: _objectSpread({
            "Content-Type": "application/json"
          }, _this6.commonHeaders())
        }).map(function (ajaxResponse) {
          return ajaxResponse.response.id;
        })["catch"](function (error) {
          return _this6.catchPostError(error);
        });
      })["catch"](function (error) {
        return _this6.catchExpiredToken(error);
      });
    }
  }, {
    key: "postMessageWithAttachments",
    value: function postMessageWithAttachments(message) {
      var _this7 = this;

      var attachments = message.attachments; // We clean the attachments but making sure every attachment has unique name.
      // If the file do not have a name, Chrome will assign "blob" when it is appended to FormData.

      var attachmentNames = (0, _dedupeFilenames["default"])(attachments.map(function (media) {
        return media.name || 'blob';
      }));
      var cleansedAttachments = attachments.map(function (attachment, index) {
        return _objectSpread({}, attachment, {
          name: attachmentNames[index]
        });
      });
      var formData; // If we're not connected to the bot, get connected
      // Will throw an error if we are not connected

      return this.checkConnection(true).flatMap(function (_) {
        // To send this message to DirectLine we need to deconstruct it into a "template" activity
        // and one blob for each attachment.
        formData = new FormData();
        formData.append('activity', new Blob([JSON.stringify(_objectSpread({}, message, {
          // Removing contentUrl from attachment, we will send it via multipart
          attachments: cleansedAttachments.map(function (_ref) {
            var string = _ref.contentUrl,
                others = (0, _objectWithoutProperties2["default"])(_ref, ["contentUrl"]);
            return _objectSpread({}, others);
          })
        }))], {
          type: 'application/vnd.microsoft.activity'
        }));
        return _Observable.Observable.from(cleansedAttachments, _this7.services.scheduler).flatMap(function (media) {
          return _this7.services.ajax({
            method: "GET",
            url: media.contentUrl,
            responseType: 'arraybuffer'
          })["do"](function (ajaxResponse) {
            return formData.append('file', new Blob([ajaxResponse.response], {
              type: media.contentType
            }), media.name);
          });
        }).count();
      }).flatMap(function (_) {
        return _this7.services.ajax({
          method: "POST",
          url: "".concat(_this7.domain, "/conversations/").concat(_this7.conversationId, "/upload?userId=").concat(message.from.id),
          body: formData,
          timeout: _this7.timeout,
          headers: _objectSpread({}, _this7.commonHeaders())
        }).map(function (ajaxResponse) {
          return ajaxResponse.response.id;
        })["catch"](function (error) {
          return _this7.catchPostError(error);
        });
      })["catch"](function (error) {
        return _this7.catchPostError(error);
      });
    }
  }, {
    key: "catchPostError",
    value: function catchPostError(error) {
      if (error.status === 403) // token has expired (will fall through to return "retry")
        this.expiredToken();else if (error.status >= 400 && error.status < 500) // more unrecoverable errors
        return _Observable.Observable["throw"](error, this.services.scheduler);
      return _Observable.Observable.of("retry", this.services.scheduler);
    }
  }, {
    key: "catchExpiredToken",
    value: function catchExpiredToken(error) {
      return error === errorExpiredToken ? _Observable.Observable.of("retry", this.services.scheduler) : _Observable.Observable["throw"](error, this.services.scheduler);
    }
  }, {
    key: "pollingGetActivity$",
    value: function pollingGetActivity$() {
      var _this8 = this;

      var poller$ = _Observable.Observable.create(function (subscriber) {
        // A BehaviorSubject to trigger polling. Since it is a BehaviorSubject
        // the first event is produced immediately.
        var trigger$ = new _BehaviorSubject.BehaviorSubject({}); // TODO: remove Date.now, use reactive interval to space out every request

        trigger$.subscribe(function () {
          if (_this8.connectionStatus$.getValue() === ConnectionStatus.Online) {
            var startTimestamp = Date.now();

            _this8.services.ajax({
              headers: _objectSpread({
                Accept: 'application/json'
              }, _this8.commonHeaders()),
              method: 'GET',
              url: "".concat(_this8.domain, "/conversations/").concat(_this8.conversationId, "/activities?watermark=").concat(_this8.watermark),
              timeout: _this8.timeout
            }).subscribe(function (result) {
              subscriber.next(result);
              setTimeout(function () {
                return trigger$.next(null);
              }, Math.max(0, _this8.pollingInterval - Date.now() + startTimestamp));
            }, function (error) {
              switch (error.status) {
                case 403:
                  _this8.connectionStatus$.next(ConnectionStatus.ExpiredToken);

                  setTimeout(function () {
                    return trigger$.next(null);
                  }, _this8.pollingInterval);
                  break;

                case 404:
                  _this8.connectionStatus$.next(ConnectionStatus.Ended);

                  break;

                default:
                  // propagate the error
                  subscriber.error(error);
                  break;
              }
            });
          }
        });
      });

      return this.checkConnection().flatMap(function (_) {
        return poller$["catch"](function () {
          return _Observable.Observable.empty();
        }).map(function (ajaxResponse) {
          return ajaxResponse.response;
        }).flatMap(function (activityGroup) {
          return _this8.observableFromActivityGroup(activityGroup);
        });
      });
    }
  }, {
    key: "observableFromActivityGroup",
    value: function observableFromActivityGroup(activityGroup) {
      if (activityGroup.watermark) this.watermark = activityGroup.watermark;
      return _Observable.Observable.from(activityGroup.activities, this.services.scheduler);
    }
  }, {
    key: "webSocketActivity$",
    value: function webSocketActivity$() {
      var _this9 = this;

      return this.checkConnection().flatMap(function (_) {
        return _this9.observableWebSocket() // WebSockets can be closed by the server or the browser. In the former case we need to
        // retrieve a new streamUrl. In the latter case we could first retry with the current streamUrl,
        // but it's simpler just to always fetch a new one.
        .retryWhen(function (error$) {
          return error$.delay(_this9.getRetryDelay(), _this9.services.scheduler).mergeMap(function (error) {
            return _this9.reconnectToConversation();
          });
        });
      }).flatMap(function (activityGroup) {
        return _this9.observableFromActivityGroup(activityGroup);
      });
    } // Returns the delay duration in milliseconds

  }, {
    key: "getRetryDelay",
    value: function getRetryDelay() {
      return Math.floor(3000 + this.services.random() * 12000);
    } // Originally we used Observable.webSocket, but it's fairly opinionated and I ended up writing
    // a lot of code to work around their implementation details. Since WebChat is meant to be a reference
    // implementation, I decided roll the below, where the logic is more purposeful. - @billba

  }, {
    key: "observableWebSocket",
    value: function observableWebSocket() {
      var _this10 = this;

      return _Observable.Observable.create(function (subscriber) {
        konsole.log("creating WebSocket", _this10.streamUrl);
        var ws = new _this10.services.WebSocket(_this10.streamUrl);
        var sub;

        ws.onopen = function (open) {
          konsole.log("WebSocket open", open); // Chrome is pretty bad at noticing when a WebSocket connection is broken.
          // If we periodically ping the server with empty messages, it helps Chrome
          // realize when connection breaks, and close the socket. We then throw an
          // error, and that give us the opportunity to attempt to reconnect.

          sub = _Observable.Observable.interval(_this10.timeout, _this10.services.scheduler).subscribe(function (_) {
            try {
              ws.send("");
            } catch (e) {
              konsole.log("Ping error", e);
            }
          });
        };

        ws.onclose = function (close) {
          konsole.log("WebSocket close", close);
          if (sub) sub.unsubscribe();
          subscriber.error(close);
        };

        ws.onmessage = function (message) {
          return message.data && subscriber.next(JSON.parse(message.data));
        }; // This is the 'unsubscribe' method, which is called when this observable is disposed.
        // When the WebSocket closes itself, we throw an error, and this function is eventually called.
        // When the observable is closed first (e.g. when tearing down a WebChat instance) then
        // we need to manually close the WebSocket.


        return function () {
          if (ws.readyState === 0 || ws.readyState === 1) ws.close();
        };
      });
    }
  }, {
    key: "reconnectToConversation",
    value: function reconnectToConversation() {
      var _this11 = this;

      return this.checkConnection(true).flatMap(function (_) {
        return _this11.services.ajax({
          method: "GET",
          url: "".concat(_this11.domain, "/conversations/").concat(_this11.conversationId, "?watermark=").concat(_this11.watermark),
          timeout: _this11.timeout,
          headers: _objectSpread({
            "Accept": "application/json"
          }, _this11.commonHeaders())
        })["do"](function (result) {
          if (!_this11.secret) _this11.token = result.response.token;
          _this11.streamUrl = result.response.streamUrl;
        }).map(function (_) {
          return null;
        }).retryWhen(function (error$) {
          return error$.mergeMap(function (error) {
            if (error.status === 403) {
              // token has expired. We can't recover from this here, but the embedding
              // website might eventually call reconnect() with a new token and streamUrl.
              _this11.expiredToken();
            } else if (error.status === 404) {
              return _Observable.Observable["throw"](errorConversationEnded, _this11.services.scheduler);
            }

            return _Observable.Observable.of(error, _this11.services.scheduler);
          }).delay(_this11.timeout, _this11.services.scheduler).take(_this11.retries);
        });
      });
    }
  }, {
    key: "commonHeaders",
    value: function commonHeaders() {
      return Object.assign({
        "Authorization": "Bearer ".concat(this.token),
        "x-ms-bot-agent": this._botAgent
      }, this.botIdHeader ? {
        'x-ms-bot-id': this.botIdHeader
      } : null);
    }
  }, {
    key: "getBotAgent",
    value: function getBotAgent() {
      var customAgent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var clientAgent = 'directlinejs';

      if (customAgent) {
        clientAgent += "; ".concat(customAgent);
      }

      return "".concat(DIRECT_LINE_VERSION, " (").concat(clientAgent, " ").concat("0.12.0", ")");
    }
  }]);
  return DirectLine;
}();

exports.DirectLine = DirectLine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9kaXJlY3RMaW5lLnRzIl0sIm5hbWVzIjpbIkRJUkVDVF9MSU5FX1ZFUlNJT04iLCJDb25uZWN0aW9uU3RhdHVzIiwid3JhcEFqYXhXaXRoUmV0cnkiLCJzb3VyY2UiLCJzY2hlZHVsZXIiLCJub3RJbXBsZW1lbnRlZCIsIkVycm9yIiwiaW5uZXIiLCJyZXNwb25zZSQiLCJlcnIiLCJzdGF0dXMiLCJyZXRyeUFmdGVyVmFsdWUiLCJ4aHIiLCJnZXRSZXNwb25zZUhlYWRlciIsInJldHJ5QWZ0ZXIiLCJOdW1iZXIiLCJpc05hTiIsIk9ic2VydmFibGUiLCJ0aW1lciIsImZsYXRNYXAiLCJfIiwib3V0ZXIiLCJ1cmxPclJlcXVlc3QiLCJPYmplY3QiLCJhc3NpZ24iLCJnZXQiLCJ1cmwiLCJoZWFkZXJzIiwicG9zdCIsImJvZHkiLCJwdXQiLCJwYXRjaCIsImdldEpTT04iLCJtYWtlU2VydmljZXMiLCJzZXJ2aWNlcyIsIkFzeW5jU2NoZWR1bGVyIiwiYWpheCIsIldlYlNvY2tldCIsInJhbmRvbSIsIk1hdGgiLCJsaWZldGltZVJlZnJlc2hUb2tlbiIsImludGVydmFsUmVmcmVzaFRva2VuIiwiUE9MTElOR19JTlRFUlZBTF9MT1dFUl9CT1VORCIsImVycm9yRXhwaXJlZFRva2VuIiwiZXJyb3JDb252ZXJzYXRpb25FbmRlZCIsImVycm9yRmFpbGVkVG9Db25uZWN0Iiwia29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJvcHRpb25hbFBhcmFtcyIsIndpbmRvdyIsImNvbnNvbGUiLCJEaXJlY3RMaW5lIiwib3B0aW9ucyIsIkJlaGF2aW9yU3ViamVjdCIsIlVuaW5pdGlhbGl6ZWQiLCJzZWNyZXQiLCJ0b2tlbiIsIndlYlNvY2tldCIsInVuZGVmaW5lZCIsImRvbWFpbiIsImNvbnZlcnNhdGlvbklkIiwid2F0ZXJtYXJrIiwic3RyZWFtVXJsIiwid2FybiIsInRpbWVvdXQiLCJyZXRyaWVzIiwiX2JvdEFnZW50IiwiZ2V0Qm90QWdlbnQiLCJib3RBZ2VudCIsInBhcnNlZFBvbGxpbmdJbnRlcnZhbCIsInBvbGxpbmdJbnRlcnZhbCIsImV4cGlyZWRUb2tlbkV4aGF1c3Rpb24iLCJzZXRDb25uZWN0aW9uU3RhdHVzRmFsbGJhY2siLCJFeHBpcmVkVG9rZW4iLCJGYWlsZWRUb0Nvbm5lY3QiLCJhY3Rpdml0eSQiLCJ3ZWJTb2NrZXRBY3Rpdml0eSQiLCJwb2xsaW5nR2V0QWN0aXZpdHkkIiwic2hhcmUiLCJvbmNlIiwib2JzIiwiY29ubmVjdGlvblN0YXR1cyQiLCJjb25uZWN0aW9uU3RhdHVzIiwibmV4dCIsIkNvbm5lY3RpbmciLCJPbmxpbmUiLCJvZiIsInN0YXJ0Q29udmVyc2F0aW9uIiwiY29udmVyc2F0aW9uIiwicmVmZXJlbmNlR3JhbW1hcklkIiwicmVmcmVzaFRva2VuTG9vcCIsImVycm9yIiwibWFwIiwiZmlsdGVyIiwiRW5kZWQiLCJ0YWtlIiwiY29ubmVjdGlvblN0YXR1c0Zyb20iLCJjb25uZWN0aW9uU3RhdHVzVG8iLCJtYXhBdHRlbXB0cyIsImF0dGVtcHRzIiwiY3VyclN0YXR1cyIsImdldFZhbHVlIiwicHJvdGVjdGVkQ29ubmVjdGlvblN0YXR1cyIsIm1ldGhvZCIsImNvbW1vbkhlYWRlcnMiLCJhamF4UmVzcG9uc2UiLCJib3RJZEhlYWRlciIsInJlc3BvbnNlIiwicmV0cnlXaGVuIiwiZXJyb3IkIiwibWVyZ2VNYXAiLCJkZWxheSIsInRva2VuUmVmcmVzaFN1YnNjcmlwdGlvbiIsImludGVydmFsIiwicmVmcmVzaFRva2VuIiwic3Vic2NyaWJlIiwiRGF0ZSIsImNoZWNrQ29ubmVjdGlvbiIsImV4cGlyZWRUb2tlbiIsInVuc3Vic2NyaWJlIiwiZSIsIndpdGhDcmVkZW50aWFscyIsInNlc3Npb25JZCIsImNhdGNoRXhwaXJlZFRva2VuIiwiYWN0aXZpdHkiLCJ0eXBlIiwiYXR0YWNobWVudHMiLCJsZW5ndGgiLCJwb3N0TWVzc2FnZVdpdGhBdHRhY2htZW50cyIsImlkIiwiY2F0Y2hQb3N0RXJyb3IiLCJhdHRhY2htZW50TmFtZXMiLCJtZWRpYSIsIm5hbWUiLCJjbGVhbnNlZEF0dGFjaG1lbnRzIiwiYXR0YWNobWVudCIsImluZGV4IiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsImFwcGVuZCIsIkJsb2IiLCJKU09OIiwic3RyaW5naWZ5Iiwic3RyaW5nIiwiY29udGVudFVybCIsIm90aGVycyIsImZyb20iLCJyZXNwb25zZVR5cGUiLCJjb250ZW50VHlwZSIsImNvdW50IiwicG9sbGVyJCIsImNyZWF0ZSIsInN1YnNjcmliZXIiLCJ0cmlnZ2VyJCIsInN0YXJ0VGltZXN0YW1wIiwibm93IiwiQWNjZXB0IiwicmVzdWx0Iiwic2V0VGltZW91dCIsIm1heCIsImVtcHR5IiwiYWN0aXZpdHlHcm91cCIsIm9ic2VydmFibGVGcm9tQWN0aXZpdHlHcm91cCIsImFjdGl2aXRpZXMiLCJvYnNlcnZhYmxlV2ViU29ja2V0IiwiZ2V0UmV0cnlEZWxheSIsInJlY29ubmVjdFRvQ29udmVyc2F0aW9uIiwiZmxvb3IiLCJ3cyIsInN1YiIsIm9ub3BlbiIsIm9wZW4iLCJzZW5kIiwib25jbG9zZSIsImNsb3NlIiwib25tZXNzYWdlIiwiZGF0YSIsInBhcnNlIiwicmVhZHlTdGF0ZSIsImN1c3RvbUFnZW50IiwiY2xpZW50QWdlbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBSUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBR0E7Ozs7OztBQUdBLElBQU1BLG1CQUFtQixHQUFHLGdCQUE1QjtBQXdUQTtJQUVZQyxnQjs7O1dBQUFBLGdCO0FBQUFBLEVBQUFBLGdCLENBQUFBLGdCO0FBQUFBLEVBQUFBLGdCLENBQUFBLGdCO0FBQUFBLEVBQUFBLGdCLENBQUFBLGdCO0FBQUFBLEVBQUFBLGdCLENBQUFBLGdC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Q0gsYUFKRCxNQUlPLElBQUkzQixLQUFLLENBQUNsRixNQUFOLEtBQWlCLEdBQXJCLEVBQTBCO0FBQzdCLHFCQUFPTyxnQ0FBaUIyQixzQkFBakIsRUFBeUMsT0FBSSxDQUFDVixRQUFMLENBQWM5QixTQUF2RCxDQUFQO0FBQ0g7O0FBRUQsbUJBQU9hLHVCQUFXc0UsRUFBWCxDQUFjSyxLQUFkLEVBQXFCLE9BQUksQ0FBQzFELFFBQUwsQ0FBYzlCLFNBQW5DLENBQVA7QUFDSCxXQVhnQixFQVloQjRHLEtBWmdCLENBWVYsT0FBSSxDQUFDL0MsT0FaSyxFQVlJLE9BQUksQ0FBQy9CLFFBQUwsQ0FBYzlCLFNBWmxCLEVBYWhCNEYsSUFiZ0IsQ0FhWCxPQUFJLENBQUM5QixPQWJNLENBQUo7QUFBQSxTQWZqQixDQURNO0FBQUEsT0FESCxDQUFQO0FBaUNIOzs7b0NBRXVCO0FBQ2hCLGFBQU8zQyxNQUFNLENBQUNDLE1BQVAsQ0FBYztBQUNqQiwwQ0FBMkIsS0FBS2lDLEtBQWhDLENBRGlCO0FBRWpCLDBCQUFrQixLQUFLVTtBQUZOLE9BQWQsRUFHSCxLQUFLd0MsV0FBTCxHQUFtQjtBQUFDLHVCQUFlLEtBQUtBO0FBQXJCLE9BQW5CLEdBQXNELElBSG5ELENBQVA7QUFJUDs7O2tDQUVxRDtBQUFBLFVBQWxDeUUsV0FBa0MsdUVBQVosRUFBWTtBQUNsRCxVQUFJQyxXQUFXLEdBQUcsY0FBbEI7O0FBRUEsVUFBSUQsV0FBSixFQUFpQjtBQUNiQyxRQUFBQSxXQUFXLGdCQUFTRCxXQUFULENBQVg7QUFDSDs7QUFFRCx1QkFBVXBMLG1CQUFWLGVBQWtDcUwsV0FBbEM7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbIi8vIEluIG9yZGVyIHRvIGtlZXAgZmlsZSBzaXplIGRvd24sIG9ubHkgaW1wb3J0IHRoZSBwYXJ0cyBvZiByeGpzIHRoYXQgd2UgdXNlXG5cbmltcG9ydCAnY29yZS1qcy9mZWF0dXJlcy9wcm9taXNlJztcbmltcG9ydCAndXJsLXNlYXJjaC1wYXJhbXMtcG9seWZpbGwnO1xuaW1wb3J0IHsgQWpheFJlc3BvbnNlLCBBamF4Q3JlYXRpb25NZXRob2QsIEFqYXhSZXF1ZXN0LCBBamF4RXJyb3IgfSBmcm9tICdyeGpzL29ic2VydmFibGUvZG9tL0FqYXhPYnNlcnZhYmxlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMvQmVoYXZpb3JTdWJqZWN0JztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL09ic2VydmFibGUnO1xuaW1wb3J0IHsgSVNjaGVkdWxlciB9IGZyb20gJ3J4anMvU2NoZWR1bGVyJztcbmltcG9ydCB7IFN1YnNjcmliZXIgfSBmcm9tICdyeGpzL1N1YnNjcmliZXInO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcy9TdWJzY3JpcHRpb24nO1xuaW1wb3J0IHsgYXN5bmMgYXMgQXN5bmNTY2hlZHVsZXIgfSBmcm9tICdyeGpzL3NjaGVkdWxlci9hc3luYyc7XG5cbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvY2F0Y2gnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9jb21iaW5lTGF0ZXN0JztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvY291bnQnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9kZWxheSc7XG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL2RvJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvZmlsdGVyJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvbWFwJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvbWVyZ2VNYXAnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9jb25jYXRNYXAnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9yZXRyeVdoZW4nO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9zaGFyZSc7XG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL3Rha2UnO1xuXG5pbXBvcnQgJ3J4anMvYWRkL29ic2VydmFibGUvZG9tL2FqYXgnO1xuaW1wb3J0ICdyeGpzL2FkZC9vYnNlcnZhYmxlL2VtcHR5JztcbmltcG9ydCAncnhqcy9hZGQvb2JzZXJ2YWJsZS9mcm9tJztcbmltcG9ydCAncnhqcy9hZGQvb2JzZXJ2YWJsZS9pbnRlcnZhbCc7XG5pbXBvcnQgJ3J4anMvYWRkL29ic2VydmFibGUvb2YnO1xuaW1wb3J0ICdyeGpzL2FkZC9vYnNlcnZhYmxlL3Rocm93JztcblxuaW1wb3J0IGRlZHVwZUZpbGVuYW1lcyBmcm9tICcuL2RlZHVwZUZpbGVuYW1lcyc7XG5pbXBvcnQgeyBvYmplY3RFeHByZXNzaW9uIH0gZnJvbSAnQGJhYmVsL3R5cGVzJztcblxuaW1wb3J0IHsgRGlyZWN0TGluZVN0cmVhbWluZyB9IGZyb20gJy4vZGlyZWN0TGluZVN0cmVhbWluZyc7XG5leHBvcnQgeyBEaXJlY3RMaW5lU3RyZWFtaW5nIH07XG5cbmNvbnN0IERJUkVDVF9MSU5FX1ZFUlNJT04gPSAnRGlyZWN0TGluZS8zLjAnO1xuXG5kZWNsYXJlIHZhciBwcm9jZXNzOiB7XG4gICAgYXJjaDogc3RyaW5nO1xuICAgIGVudjoge1xuICAgICAgICBWRVJTSU9OOiBzdHJpbmc7XG4gICAgICAgIG5wbV9wYWNrYWdlX3ZlcnNpb246IHN0cmluZztcbiAgICB9O1xuICAgIHBsYXRmb3JtOiBzdHJpbmc7XG4gICAgcmVsZWFzZTogc3RyaW5nO1xuICAgIHZlcnNpb246IHN0cmluZztcbn07XG5cbi8vIERpcmVjdCBMaW5lIDMuMCB0eXBlc1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbnZlcnNhdGlvbiB7XG4gICAgY29udmVyc2F0aW9uSWQ6IHN0cmluZyxcbiAgICB0b2tlbjogc3RyaW5nLFxuICAgIGVUYWc/OiBzdHJpbmcsXG4gICAgc3RyZWFtVXJsPzogc3RyaW5nLFxuICAgIHJlZmVyZW5jZUdyYW1tYXJJZD86IHN0cmluZ1xufVxuXG5leHBvcnQgdHlwZSBNZWRpYVR5cGUgPSBcImltYWdlL3BuZ1wiIHwgXCJpbWFnZS9qcGdcIiB8IFwiaW1hZ2UvanBlZ1wiIHwgXCJpbWFnZS9naWZcIiB8IFwiaW1hZ2Uvc3ZnK3htbFwiIHwgXCJhdWRpby9tcGVnXCIgfCBcImF1ZGlvL21wNFwiIHwgXCJ2aWRlby9tcDRcIjtcblxuZXhwb3J0IGludGVyZmFjZSBNZWRpYSB7XG4gICAgY29udGVudFR5cGU6IE1lZGlhVHlwZSxcbiAgICBjb250ZW50VXJsOiBzdHJpbmcsXG4gICAgbmFtZT86IHN0cmluZyxcbiAgICB0aHVtYm5haWxVcmw/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVbmtub3duTWVkaWF7XG4gICAgY29udGVudFR5cGU6IHN0cmluZyxcbiAgICBjb250ZW50VXJsOiBzdHJpbmcsXG4gICAgbmFtZT86IHN0cmluZyxcbiAgICB0aHVtYm5haWxVcmw/OiBzdHJpbmdcbn1cblxuZXhwb3J0IHR5cGUgQ2FyZEFjdGlvblR5cGVzID0gXCJjYWxsXCIgfCBcImRvd25sb2FkRmlsZVwifCBcImltQmFja1wiIHwgXCJtZXNzYWdlQmFja1wiIHwgXCJvcGVuVXJsXCIgfCBcInBsYXlBdWRpb1wiIHwgXCJwbGF5VmlkZW9cIiB8IFwicG9zdEJhY2tcIiB8IFwic2lnbmluXCIgfCBcInNob3dJbWFnZVwiO1xuXG5leHBvcnQgdHlwZSBDYXJkQWN0aW9uID0gQ2FsbENhcmRBY3Rpb24gfCBEb3dubG9hZEZpbGVDYXJkQWN0aW9uIHwgSU1CYWNrQ2FyZEFjdGlvbiB8IE1lc3NhZ2VCYWNrQ2FyZEFjdGlvbiB8IE9wZW5VUkxDYXJkQWN0aW9uIHwgUGxheUF1ZGlvQ2FyZEFjdGlvbiB8IFBsYXlWaWRlb0NhcmRBY3Rpb24gfCBQb3N0QmFja0NhcmRBY3Rpb24gfCBTaWduSW5DYXJkQWN0aW9uIHwgU2hvd0ltYWdlQ2FyZEFjdGlvbjtcblxuZXhwb3J0IGludGVyZmFjZSBDYWxsQ2FyZEFjdGlvbiB7XG4gICAgaW1hZ2U/OiBzdHJpbmcsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICB0eXBlOiBcImNhbGxcIixcbiAgICB2YWx1ZTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRG93bmxvYWRGaWxlQ2FyZEFjdGlvbiB7XG4gICAgaW1hZ2U/OiBzdHJpbmcsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICB0eXBlOiBcImRvd25sb2FkRmlsZVwiLFxuICAgIHZhbHVlOiBhbnlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJTUJhY2tDYXJkQWN0aW9uIHtcbiAgICBpbWFnZT86IHN0cmluZyxcbiAgICB0aXRsZT86IHN0cmluZyxcbiAgICB0eXBlOiBcImltQmFja1wiLFxuICAgIHZhbHVlOiBzdHJpbmdcbn1cblxuZXhwb3J0IHR5cGUgTWVzc2FnZUJhY2tDYXJkQWN0aW9uID0gTWVzc2FnZUJhY2tXaXRoSW1hZ2UgfCBNZXNzYWdlQmFja1dpdGhUaXRsZVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VCYWNrV2l0aEltYWdlIHtcbiAgICBkaXNwbGF5VGV4dD86IHN0cmluZyxcbiAgICBpbWFnZTogc3RyaW5nLFxuICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgdHlwZTogXCJtZXNzYWdlQmFja1wiLFxuICAgIHZhbHVlPzogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVzc2FnZUJhY2tXaXRoVGl0bGUge1xuICAgIGRpc3BsYXlUZXh0Pzogc3RyaW5nLFxuICAgIGltYWdlPzogc3RyaW5nLFxuICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICB0eXBlOiBcIm1lc3NhZ2VCYWNrXCIsXG4gICAgdmFsdWU/OiBhbnlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcGVuVVJMQ2FyZEFjdGlvbiB7XG4gICAgaW1hZ2U/OiBzdHJpbmcsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICB0eXBlOiBcIm9wZW5VcmxcIixcbiAgICB2YWx1ZTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGxheUF1ZGlvQ2FyZEFjdGlvbiB7XG4gICAgaW1hZ2U/OiBzdHJpbmcsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICB0eXBlOiBcInBsYXlBdWRpb1wiLFxuICAgIHZhbHVlOiBhbnlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQbGF5VmlkZW9DYXJkQWN0aW9uIHtcbiAgICBpbWFnZT86IHN0cmluZyxcbiAgICB0aXRsZTogc3RyaW5nLFxuICAgIHR5cGU6IFwicGxheVZpZGVvXCIsXG4gICAgdmFsdWU6IGFueVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvc3RCYWNrQ2FyZEFjdGlvbiB7XG4gICAgaW1hZ2U/OiBzdHJpbmcsXG4gICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgdHlwZTogXCJwb3N0QmFja1wiLFxuICAgIHZhbHVlOiBhbnlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaG93SW1hZ2VDYXJkQWN0aW9uIHtcbiAgICBpbWFnZT86IHN0cmluZyxcbiAgICB0aXRsZTogc3RyaW5nLFxuICAgIHR5cGU6IFwic2hvd0ltYWdlXCIsXG4gICAgdmFsdWU6IGFueVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNpZ25JbkNhcmRBY3Rpb24ge1xuICAgIGltYWdlPzogc3RyaW5nLFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgdHlwZTogXCJzaWduaW5cIixcbiAgICB2YWx1ZTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FyZEltYWdlIHtcbiAgICBhbHQ/OiBzdHJpbmcsXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgdGFwPzogQ2FyZEFjdGlvblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEhlcm9DYXJkIHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQuaGVyb1wiLFxuICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHN1YnRpdGxlPzogc3RyaW5nLFxuICAgICAgICB0ZXh0Pzogc3RyaW5nLFxuICAgICAgICBpbWFnZXM/OiBDYXJkSW1hZ2VbXSxcbiAgICAgICAgYnV0dG9ucz86IENhcmRBY3Rpb25bXSxcbiAgICAgICAgdGFwPzogQ2FyZEFjdGlvblxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBUaHVtYm5haWwge1xuICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL3ZuZC5taWNyb3NvZnQuY2FyZC50aHVtYm5haWxcIixcbiAgICBjb250ZW50OiB7XG4gICAgICAgIHRpdGxlPzogc3RyaW5nLFxuICAgICAgICBzdWJ0aXRsZT86IHN0cmluZyxcbiAgICAgICAgdGV4dD86IHN0cmluZyxcbiAgICAgICAgaW1hZ2VzPzogQ2FyZEltYWdlW10sXG4gICAgICAgIGJ1dHRvbnM/OiBDYXJkQWN0aW9uW10sXG4gICAgICAgIHRhcD86IENhcmRBY3Rpb25cbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2lnbmluIHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQuc2lnbmluXCIsXG4gICAgY29udGVudDoge1xuICAgICAgICB0ZXh0Pzogc3RyaW5nLFxuICAgICAgICBidXR0b25zPzogQ2FyZEFjdGlvbltdXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9BdXRoIHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQub2F1dGhcIixcbiAgICBjb250ZW50OiB7XG4gICAgICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgICAgIGNvbm5lY3Rpb25uYW1lOiBzdHJpbmcsXG4gICAgICAgIGJ1dHRvbnM/OiBDYXJkQWN0aW9uW11cbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZWlwdEl0ZW0ge1xuICAgIHRpdGxlPzogc3RyaW5nLFxuICAgIHN1YnRpdGxlPzogc3RyaW5nLFxuICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgaW1hZ2U/OiBDYXJkSW1hZ2UsXG4gICAgcHJpY2U/OiBzdHJpbmcsXG4gICAgcXVhbnRpdHk/OiBzdHJpbmcsXG4gICAgdGFwPzogQ2FyZEFjdGlvblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlY2VpcHQge1xuICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL3ZuZC5taWNyb3NvZnQuY2FyZC5yZWNlaXB0XCIsXG4gICAgY29udGVudDoge1xuICAgICAgICB0aXRsZT86IHN0cmluZyxcbiAgICAgICAgZmFjdHM/OiB7IGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIH1bXSxcbiAgICAgICAgaXRlbXM/OiBSZWNlaXB0SXRlbVtdLFxuICAgICAgICB0YXA/OiBDYXJkQWN0aW9uLFxuICAgICAgICB0YXg/OiBzdHJpbmcsXG4gICAgICAgIHZhdD86IHN0cmluZyxcbiAgICAgICAgdG90YWw/OiBzdHJpbmcsXG4gICAgICAgIGJ1dHRvbnM/OiBDYXJkQWN0aW9uW11cbiAgICB9XG59XG5cbi8vIERlcHJlY2F0ZWQgZm9ybWF0IGZvciBTa3lwZSBjaGFubmVscy4gRm9yIHRlc3RpbmcgbGVnYWN5IGJvdHMgaW4gRW11bGF0b3Igb25seS5cbmV4cG9ydCBpbnRlcmZhY2UgRmxleENhcmQge1xuICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL3ZuZC5taWNyb3NvZnQuY2FyZC5mbGV4XCIsXG4gICAgY29udGVudDoge1xuICAgICAgICB0aXRsZT86IHN0cmluZyxcbiAgICAgICAgc3VidGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgICAgIGltYWdlcz86IENhcmRJbWFnZVtdLFxuICAgICAgICBidXR0b25zPzogQ2FyZEFjdGlvbltdLFxuICAgICAgICBhc3BlY3Q/OiBzdHJpbmdcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXVkaW9DYXJkIHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQuYXVkaW9cIixcbiAgICBjb250ZW50OiB7XG4gICAgICAgIHRpdGxlPzogc3RyaW5nLFxuICAgICAgICBzdWJ0aXRsZT86IHN0cmluZyxcbiAgICAgICAgdGV4dD86IHN0cmluZyxcbiAgICAgICAgbWVkaWE/OiB7IHVybDogc3RyaW5nLCBwcm9maWxlPzogc3RyaW5nIH1bXSxcbiAgICAgICAgYnV0dG9ucz86IENhcmRBY3Rpb25bXSxcbiAgICAgICAgYXV0b2xvb3A/OiBib29sZWFuLFxuICAgICAgICBhdXRvc3RhcnQ/OiBib29sZWFuXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZpZGVvQ2FyZCB7XG4gICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vdm5kLm1pY3Jvc29mdC5jYXJkLnZpZGVvXCIsXG4gICAgY29udGVudDoge1xuICAgICAgICB0aXRsZT86IHN0cmluZyxcbiAgICAgICAgc3VidGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgICAgIG1lZGlhPzogeyB1cmw6IHN0cmluZywgcHJvZmlsZT86IHN0cmluZyB9W10sXG4gICAgICAgIGJ1dHRvbnM/OiBDYXJkQWN0aW9uW10sXG4gICAgICAgIGltYWdlPzogeyB1cmw6IHN0cmluZywgYWx0Pzogc3RyaW5nIH0sXG4gICAgICAgIGF1dG9sb29wPzogYm9vbGVhbixcbiAgICAgICAgYXV0b3N0YXJ0PzogYm9vbGVhblxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBZGFwdGl2ZUNhcmQge1xuICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL3ZuZC5taWNyb3NvZnQuY2FyZC5hZGFwdGl2ZVwiLFxuICAgIGNvbnRlbnQ6IGFueTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbmltYXRpb25DYXJkIHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQuYW5pbWF0aW9uXCIsXG4gICAgY29udGVudDoge1xuICAgICAgICB0aXRsZT86IHN0cmluZyxcbiAgICAgICAgc3VidGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgICAgIG1lZGlhPzogeyB1cmw6IHN0cmluZywgcHJvZmlsZT86IHN0cmluZyB9W10sXG4gICAgICAgIGJ1dHRvbnM/OiBDYXJkQWN0aW9uW10sXG4gICAgICAgIGltYWdlPzogeyB1cmw6IHN0cmluZywgYWx0Pzogc3RyaW5nIH0sXG4gICAgICAgIGF1dG9sb29wPzogYm9vbGVhbixcbiAgICAgICAgYXV0b3N0YXJ0PzogYm9vbGVhblxuICAgIH1cbn1cblxuZXhwb3J0IHR5cGUgS25vd25NZWRpYSA9IE1lZGlhIHwgSGVyb0NhcmQgfCBUaHVtYm5haWwgfCBTaWduaW4gfCBPQXV0aCB8IFJlY2VpcHQgfCBBdWRpb0NhcmQgfCBWaWRlb0NhcmQgfCBBbmltYXRpb25DYXJkIHwgRmxleENhcmQgfCBBZGFwdGl2ZUNhcmQ7XG5leHBvcnQgdHlwZSBBdHRhY2htZW50ID0gS25vd25NZWRpYSB8IFVua25vd25NZWRpYTtcblxuZXhwb3J0IHR5cGUgVXNlclJvbGUgPSBcImJvdFwiIHwgXCJjaGFubmVsXCIgfCBcInVzZXJcIjtcblxuZXhwb3J0IGludGVyZmFjZSBVc2VyIHtcbiAgICBpZDogc3RyaW5nLFxuICAgIG5hbWU/OiBzdHJpbmcsXG4gICAgaWNvblVybD86IHN0cmluZyxcbiAgICByb2xlPzogVXNlclJvbGVcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQWN0aXZpdHkge1xuICAgIHR5cGU6IHN0cmluZyxcbiAgICBjaGFubmVsRGF0YT86IGFueSxcbiAgICBjaGFubmVsSWQ/OiBzdHJpbmcsXG4gICAgY29udmVyc2F0aW9uPzogeyBpZDogc3RyaW5nIH0sXG4gICAgZVRhZz86IHN0cmluZyxcbiAgICBmcm9tOiBVc2VyLFxuICAgIGlkPzogc3RyaW5nLFxuICAgIHRpbWVzdGFtcD86IHN0cmluZ1xufVxuXG5leHBvcnQgdHlwZSBBdHRhY2htZW50TGF5b3V0ID0gXCJsaXN0XCIgfCBcImNhcm91c2VsXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVzc2FnZSBleHRlbmRzIElBY3Rpdml0eSB7XG4gICAgdHlwZTogXCJtZXNzYWdlXCIsXG4gICAgdGV4dD86IHN0cmluZyxcbiAgICBsb2NhbGU/OiBzdHJpbmcsXG4gICAgdGV4dEZvcm1hdD86IFwicGxhaW5cIiB8IFwibWFya2Rvd25cIiB8IFwieG1sXCIsXG4gICAgYXR0YWNobWVudExheW91dD86IEF0dGFjaG1lbnRMYXlvdXQsXG4gICAgYXR0YWNobWVudHM/OiBBdHRhY2htZW50W10sXG4gICAgZW50aXRpZXM/OiBhbnlbXSxcbiAgICBzdWdnZXN0ZWRBY3Rpb25zPzogeyBhY3Rpb25zOiBDYXJkQWN0aW9uW10sIHRvPzogc3RyaW5nW10gfSxcbiAgICBzcGVhaz86IHN0cmluZyxcbiAgICBpbnB1dEhpbnQ/OiBzdHJpbmcsXG4gICAgdmFsdWU/OiBvYmplY3Rcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUeXBpbmcgZXh0ZW5kcyBJQWN0aXZpdHkge1xuICAgIHR5cGU6IFwidHlwaW5nXCJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFdmVudEFjdGl2aXR5IGV4dGVuZHMgSUFjdGl2aXR5IHtcbiAgICB0eXBlOiBcImV2ZW50XCIsXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHZhbHVlOiBhbnlcbn1cblxuZXhwb3J0IHR5cGUgQWN0aXZpdHkgPSBNZXNzYWdlIHwgVHlwaW5nIHwgRXZlbnRBY3Rpdml0eTtcblxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0eUdyb3VwIHtcbiAgICBhY3Rpdml0aWVzOiBBY3Rpdml0eVtdLFxuICAgIHdhdGVybWFyazogc3RyaW5nXG59XG5cbi8vIFRoZXNlIHR5cGVzIGFyZSBzcGVjaWZpYyB0byB0aGlzIGNsaWVudCBsaWJyYXJ5LCBub3QgdG8gRGlyZWN0IExpbmUgMy4wXG5cbmV4cG9ydCBlbnVtIENvbm5lY3Rpb25TdGF0dXMge1xuICAgIFVuaW5pdGlhbGl6ZWQsICAgICAgICAgICAgICAvLyB0aGUgc3RhdHVzIHdoZW4gdGhlIERpcmVjdExpbmUgb2JqZWN0IGlzIGZpcnN0IGNyZWF0ZWQvY29uc3RydWN0ZWRcbiAgICBDb25uZWN0aW5nLCAgICAgICAgICAgICAgICAgLy8gY3VycmVudGx5IHRyeWluZyB0byBjb25uZWN0IHRvIHRoZSBjb252ZXJzYXRpb25cbiAgICBPbmxpbmUsICAgICAgICAgICAgICAgICAgICAgLy8gc3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZCB0byB0aGUgY29udmVyc2F0aW9uLiBDb25uZWN0aW9uIGlzIGhlYWx0aHkgc28gZmFyIGFzIHdlIGtub3cuXG4gICAgRXhwaXJlZFRva2VuLCAgICAgICAgICAgICAgIC8vIGxhc3Qgb3BlcmF0aW9uIGVycm9yZWQgb3V0IHdpdGggYW4gZXhwaXJlZCB0b2tlbi4gUG9zc2libHkgd2FpdGluZyBmb3Igc29tZW9uZSB0byBzdXBwbHkgYSBuZXcgb25lLlxuICAgIEZhaWxlZFRvQ29ubmVjdCwgICAgICAgICAgICAvLyB0aGUgaW5pdGlhbCBhdHRlbXB0IHRvIGNvbm5lY3QgdG8gdGhlIGNvbnZlcnNhdGlvbiBmYWlsZWQuIE5vIHJlY292ZXJ5IHBvc3NpYmxlLlxuICAgIEVuZGVkICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgYm90IGVuZGVkIHRoZSBjb252ZXJzYXRpb25cbn1cblxuZXhwb3J0IGludGVyZmFjZSBEaXJlY3RMaW5lT3B0aW9ucyB7XG4gICAgc2VjcmV0Pzogc3RyaW5nLFxuICAgIHRva2VuPzogc3RyaW5nLFxuICAgIGNvbnZlcnNhdGlvbklkPzogc3RyaW5nLFxuICAgIHdhdGVybWFyaz86IHN0cmluZyxcbiAgICBkb21haW4/OiBzdHJpbmcsXG4gICAgd2ViU29ja2V0PzogYm9vbGVhbixcbiAgICBwb2xsaW5nSW50ZXJ2YWw/OiBudW1iZXIsXG4gICAgc3RyZWFtVXJsPzogc3RyaW5nLFxuICAgIHRpbWVvdXQ/OiBudW1iZXIsXG4gICAgLy8gQXR0YWNoZWQgdG8gYWxsIHJlcXVlc3RzIHRvIGlkZW50aWZ5IHJlcXVlc3RpbmcgYWdlbnQuXG4gICAgYm90QWdlbnQ/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXJ2aWNlcyB7XG4gICAgc2NoZWR1bGVyOiBJU2NoZWR1bGVyO1xuICAgIFdlYlNvY2tldDogdHlwZW9mIFdlYlNvY2tldDtcbiAgICBhamF4OiBBamF4Q3JlYXRpb25NZXRob2Q7XG4gICAgcmFuZG9tOiAoKSA9PiBudW1iZXI7XG59XG5cbmNvbnN0IHdyYXBBamF4V2l0aFJldHJ5ID0gKHNvdXJjZTogQWpheENyZWF0aW9uTWV0aG9kLCBzY2hlZHVsZXI6IElTY2hlZHVsZXIpOiBBamF4Q3JlYXRpb25NZXRob2QgPT57XG5cbiAgICBjb25zdCBub3RJbXBsZW1lbnRlZCA9ICgpOiBuZXZlciA9PiB7IHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkJyk7IH07XG5cbiAgICBjb25zdCBpbm5lciA9IChyZXNwb25zZSQgOiBPYnNlcnZhYmxlPEFqYXhSZXNwb25zZT4pID0+IHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlJFxuICAgICAgICAuY2F0Y2g8QWpheFJlc3BvbnNlLCBBamF4UmVzcG9uc2U+KChlcnIpID0+IHtcbiAgICAgICAgICAgIGlmKGVyci5zdGF0dXMgPT09IDQyOSl7XG4gICAgICAgICAgICAgICAgY29uc3QgcmV0cnlBZnRlclZhbHVlID0gZXJyLnhoci5nZXRSZXNwb25zZUhlYWRlcignUmV0cnktQWZ0ZXInKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXRyeUFmdGVyID0gTnVtYmVyKHJldHJ5QWZ0ZXJWYWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYoIWlzTmFOKHJldHJ5QWZ0ZXIpKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGltZXIocmV0cnlBZnRlciwgc2NoZWR1bGVyKVxuICAgICAgICAgICAgICAgICAgICAuZmxhdE1hcChfID0+IE9ic2VydmFibGUudGhyb3coZXJyLCBzY2hlZHVsZXIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLnRocm93KGVyciwgc2NoZWR1bGVyKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGNvbnN0IG91dGVyID0gKHVybE9yUmVxdWVzdDogc3RyaW5nfCBBamF4UmVxdWVzdCkgPT4ge1xuICAgICAgICByZXR1cm4gaW5uZXIoc291cmNlKHVybE9yUmVxdWVzdCkpO1xuICAgIH07XG5cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihvdXRlciwge1xuICAgICAgICBnZXQ6ICh1cmw6IHN0cmluZywgaGVhZGVycz86IE9iamVjdCk6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPiA9PiBub3RJbXBsZW1lbnRlZCgpLFxuICAgICAgICBwb3N0OiAodXJsOiBzdHJpbmcsIGJvZHk/OiBhbnksIGhlYWRlcnM/OiBPYmplY3QpOiBPYnNlcnZhYmxlPEFqYXhSZXNwb25zZT4gPT4gbm90SW1wbGVtZW50ZWQoKSxcbiAgICAgICAgcHV0OiAodXJsOiBzdHJpbmcsIGJvZHk/OiBhbnksIGhlYWRlcnM/OiBPYmplY3QpOiBPYnNlcnZhYmxlPEFqYXhSZXNwb25zZT4gPT4gbm90SW1wbGVtZW50ZWQoKSxcbiAgICAgICAgcGF0Y2g6ICh1cmw6IHN0cmluZywgYm9keT86IGFueSwgaGVhZGVycz86IE9iamVjdCk6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPiA9PiBub3RJbXBsZW1lbnRlZCgpLFxuICAgICAgICBkZWxldGU6ICh1cmw6IHN0cmluZywgaGVhZGVycz86IE9iamVjdCk6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPiA9PiBub3RJbXBsZW1lbnRlZCgpLFxuICAgICAgICBnZXRKU09OOiA8VD4odXJsOiBzdHJpbmcsIGhlYWRlcnM/OiBPYmplY3QpOiBPYnNlcnZhYmxlPFQ+ID0+IG5vdEltcGxlbWVudGVkKClcbiAgICB9KTtcbn1cblxuY29uc3QgbWFrZVNlcnZpY2VzID0gKHNlcnZpY2VzOiBQYXJ0aWFsPFNlcnZpY2VzPik6IFNlcnZpY2VzID0+IHtcbiAgICBjb25zdCBzY2hlZHVsZXIgPSBzZXJ2aWNlcy5zY2hlZHVsZXIgfHwgQXN5bmNTY2hlZHVsZXI7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2NoZWR1bGVyLFxuICAgICAgICBhamF4OiB3cmFwQWpheFdpdGhSZXRyeShzZXJ2aWNlcy5hamF4IHx8IE9ic2VydmFibGUuYWpheCwgc2NoZWR1bGVyKSxcbiAgICAgICAgV2ViU29ja2V0OiBzZXJ2aWNlcy5XZWJTb2NrZXQgfHwgV2ViU29ja2V0LFxuICAgICAgICByYW5kb206IHNlcnZpY2VzLnJhbmRvbSB8fCBNYXRoLnJhbmRvbSxcbiAgICB9XG59XG5cbmNvbnN0IGxpZmV0aW1lUmVmcmVzaFRva2VuID0gMzAgKiA2MCAqIDEwMDA7XG5jb25zdCBpbnRlcnZhbFJlZnJlc2hUb2tlbiA9IGxpZmV0aW1lUmVmcmVzaFRva2VuIC8gMjtcblxuY29uc3QgUE9MTElOR19JTlRFUlZBTF9MT1dFUl9CT1VORDogbnVtYmVyID0gMjAwOyAvL21zXG5cbmNvbnN0IGVycm9yRXhwaXJlZFRva2VuID0gbmV3IEVycm9yKFwiZXhwaXJlZCB0b2tlblwiKTtcbmNvbnN0IGVycm9yQ29udmVyc2F0aW9uRW5kZWQgPSBuZXcgRXJyb3IoXCJjb252ZXJzYXRpb24gZW5kZWRcIik7XG5jb25zdCBlcnJvckZhaWxlZFRvQ29ubmVjdCA9IG5ldyBFcnJvcihcImZhaWxlZCB0byBjb25uZWN0XCIpO1xuXG5jb25zdCBrb25zb2xlID0ge1xuICAgIGxvZzogKG1lc3NhZ2U/OiBhbnksIC4uLiBvcHRpb25hbFBhcmFtczogYW55W10pID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmICh3aW5kb3cgYXMgYW55KVtcImJvdGNoYXREZWJ1Z1wiXSAmJiBtZXNzYWdlKVxuICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSwgLi4uIG9wdGlvbmFsUGFyYW1zKTtcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUJvdENvbm5lY3Rpb24ge1xuICAgIGNvbm5lY3Rpb25TdGF0dXMkOiBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdGlvblN0YXR1cz4sXG4gICAgYWN0aXZpdHkkOiBPYnNlcnZhYmxlPEFjdGl2aXR5PixcbiAgICBlbmQoKTogdm9pZCxcbiAgICByZWZlcmVuY2VHcmFtbWFySWQ/OiBzdHJpbmcsXG4gICAgcG9zdEFjdGl2aXR5KGFjdGl2aXR5OiBBY3Rpdml0eSk6IE9ic2VydmFibGU8c3RyaW5nPixcbiAgICBnZXRTZXNzaW9uSWQ/IDogKCkgPT4gT2JzZXJ2YWJsZTxzdHJpbmc+XG59XG5cbmV4cG9ydCBjbGFzcyBEaXJlY3RMaW5lIGltcGxlbWVudHMgSUJvdENvbm5lY3Rpb24ge1xuICAgIHB1YmxpYyBjb25uZWN0aW9uU3RhdHVzJCA9IG5ldyBCZWhhdmlvclN1YmplY3QoQ29ubmVjdGlvblN0YXR1cy5VbmluaXRpYWxpemVkKTtcbiAgICBwdWJsaWMgYWN0aXZpdHkkOiBPYnNlcnZhYmxlPEFjdGl2aXR5PjtcblxuICAgIHByaXZhdGUgZG9tYWluID0gXCJodHRwczovL2RpcmVjdGxpbmUuYm90ZnJhbWV3b3JrLmNvbS92My9kaXJlY3RsaW5lXCI7XG4gICAgcHJpdmF0ZSB3ZWJTb2NrZXQ6IGJvb2xlYW47XG5cbiAgICBwcml2YXRlIGNvbnZlcnNhdGlvbklkOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBleHBpcmVkVG9rZW5FeGhhdXN0aW9uOiBGdW5jdGlvbjtcbiAgICBwcml2YXRlIHNlY3JldDogc3RyaW5nO1xuICAgIHByaXZhdGUgdG9rZW46IHN0cmluZztcbiAgICBwcml2YXRlIHdhdGVybWFyayA9ICcnO1xuICAgIHByaXZhdGUgc3RyZWFtVXJsOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBfYm90QWdlbnQgPSAnJztcbiAgICBwcml2YXRlIHNlcnZpY2VzOiBTZXJ2aWNlcztcbiAgICBwcml2YXRlIF91c2VyQWdlbnQ6IHN0cmluZztcbiAgICBwdWJsaWMgcmVmZXJlbmNlR3JhbW1hcklkOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBib3RJZEhlYWRlcjogc3RyaW5nO1xuICAgIHByaXZhdGUgdGltZW91dCA9IDIwICogMTAwMDtcbiAgICBwcml2YXRlIHJldHJpZXM6IG51bWJlcjtcblxuICAgIHByaXZhdGUgcG9sbGluZ0ludGVydmFsOiBudW1iZXIgPSAxMDAwOyAvL21zXG5cbiAgICBwcml2YXRlIHRva2VuUmVmcmVzaFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczogRGlyZWN0TGluZU9wdGlvbnMgJiBQYXJ0aWFsPFNlcnZpY2VzPikge1xuICAgICAgICB0aGlzLnNlY3JldCA9IG9wdGlvbnMuc2VjcmV0O1xuICAgICAgICB0aGlzLnRva2VuID0gb3B0aW9ucy5zZWNyZXQgfHwgb3B0aW9ucy50b2tlbjtcbiAgICAgICAgdGhpcy53ZWJTb2NrZXQgPSAob3B0aW9ucy53ZWJTb2NrZXQgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBvcHRpb25zLndlYlNvY2tldCkgJiYgdHlwZW9mIFdlYlNvY2tldCAhPT0gJ3VuZGVmaW5lZCcgJiYgV2ViU29ja2V0ICE9PSB1bmRlZmluZWQ7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgICB0aGlzLmRvbWFpbiA9IG9wdGlvbnMuZG9tYWluO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuY29udmVyc2F0aW9uSWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29udmVyc2F0aW9uSWQgPSBvcHRpb25zLmNvbnZlcnNhdGlvbklkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMud2F0ZXJtYXJrKSB7XG4gICAgICAgICAgICB0aGlzLndhdGVybWFyayA9ICBvcHRpb25zLndhdGVybWFyaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLnN0cmVhbVVybCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMudG9rZW4gJiYgb3B0aW9ucy5jb252ZXJzYXRpb25JZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtVXJsID0gb3B0aW9ucy5zdHJlYW1Vcmw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignRGlyZWN0TGluZUpTOiBzdHJlYW1Vcmwgd2FzIGlnbm9yZWQ6IHlvdSBuZWVkIHRvIHByb3ZpZGUgYSB0b2tlbiBhbmQgYSBjb252ZXJzYXRpb25pZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMudGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSBvcHRpb25zLnRpbWVvdXQ7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJldHJpZXMgPSAobGlmZXRpbWVSZWZyZXNoVG9rZW4gLSBpbnRlcnZhbFJlZnJlc2hUb2tlbikgLyB0aGlzLnRpbWVvdXQ7XG5cbiAgICAgICAgdGhpcy5fYm90QWdlbnQgPSB0aGlzLmdldEJvdEFnZW50KG9wdGlvbnMuYm90QWdlbnQpO1xuXG4gICAgICAgIHRoaXMuc2VydmljZXMgPSBtYWtlU2VydmljZXMob3B0aW9ucyk7XG5cbiAgICAgICAgY29uc3QgcGFyc2VkUG9sbGluZ0ludGVydmFsID0gfn5vcHRpb25zLnBvbGxpbmdJbnRlcnZhbDtcblxuICAgICAgICBpZiAocGFyc2VkUG9sbGluZ0ludGVydmFsIDwgUE9MTElOR19JTlRFUlZBTF9MT1dFUl9CT1VORCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnBvbGxpbmdJbnRlcnZhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYERpcmVjdExpbmVKUzogcHJvdmlkZWQgcG9sbGluZ0ludGVydmFsICgkeyBvcHRpb25zLnBvbGxpbmdJbnRlcnZhbCB9KSBpcyB1bmRlciBsb3dlciBib3VuZCAoMjAwbXMpLCB1c2luZyBkZWZhdWx0IG9mIDEwMDBtc2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wb2xsaW5nSW50ZXJ2YWwgPSBwYXJzZWRQb2xsaW5nSW50ZXJ2YWw7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmV4cGlyZWRUb2tlbkV4aGF1c3Rpb24gPSB0aGlzLnNldENvbm5lY3Rpb25TdGF0dXNGYWxsYmFjayhcbiAgICAgICAgICAgIENvbm5lY3Rpb25TdGF0dXMuRXhwaXJlZFRva2VuLFxuICAgICAgICAgICAgQ29ubmVjdGlvblN0YXR1cy5GYWlsZWRUb0Nvbm5lY3QsXG4gICAgICAgICAgICA1XG4gICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5hY3Rpdml0eSQgPSAodGhpcy53ZWJTb2NrZXRcbiAgICAgICAgICAgID8gdGhpcy53ZWJTb2NrZXRBY3Rpdml0eSQoKVxuICAgICAgICAgICAgOiB0aGlzLnBvbGxpbmdHZXRBY3Rpdml0eSQoKVxuICAgICAgICApLnNoYXJlKCk7XG4gICAgfVxuXG4gICAgLy8gRXZlcnkgdGltZSB3ZSdyZSBhYm91dCB0byBtYWtlIGEgRGlyZWN0IExpbmUgUkVTVCBjYWxsLCB3ZSBjYWxsIHRoaXMgZmlyc3QgdG8gc2VlIGNoZWNrIHRoZSBjdXJyZW50IGNvbm5lY3Rpb24gc3RhdHVzLlxuICAgIC8vIEVpdGhlciB0aHJvd3MgYW4gZXJyb3IgKGluZGljYXRpbmcgYW4gZXJyb3Igc3RhdGUpIG9yIGVtaXRzIGEgbnVsbCwgaW5kaWNhdGluZyBhIChwcmVzdW1hYmx5KSBoZWFsdGh5IGNvbm5lY3Rpb25cbiAgICBwcml2YXRlIGNoZWNrQ29ubmVjdGlvbihvbmNlID0gZmFsc2UpIHtcbiAgICAgICAgbGV0IG9icyA9ICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMkXG4gICAgICAgIC5mbGF0TWFwKGNvbm5lY3Rpb25TdGF0dXMgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb25TdGF0dXMgPT09IENvbm5lY3Rpb25TdGF0dXMuVW5pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLkNvbm5lY3RpbmcpO1xuXG4gICAgICAgICAgICAgICAgLy9pZiB0b2tlbiBhbmQgc3RyZWFtVXJsIGFyZSBkZWZpbmVkIGl0IG1lYW5zIHJlY29ubmVjdCBoYXMgYWxyZWFkeSBiZWVuIGRvbmUuIFNraXBwaW5nIGl0LlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRva2VuICYmIHRoaXMuc3RyZWFtVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLk9ubGluZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKGNvbm5lY3Rpb25TdGF0dXMsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGFydENvbnZlcnNhdGlvbigpLmRvKGNvbnZlcnNhdGlvbiA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnNhdGlvbklkID0gY29udmVyc2F0aW9uLmNvbnZlcnNhdGlvbklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b2tlbiA9IHRoaXMuc2VjcmV0IHx8IGNvbnZlcnNhdGlvbi50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtVXJsID0gY29udmVyc2F0aW9uLnN0cmVhbVVybDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVmZXJlbmNlR3JhbW1hcklkID0gY29udmVyc2F0aW9uLnJlZmVyZW5jZUdyYW1tYXJJZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZWNyZXQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoVG9rZW5Mb29wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLk9ubGluZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLkZhaWxlZFRvQ29ubmVjdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoXyA9PiBjb25uZWN0aW9uU3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihjb25uZWN0aW9uU3RhdHVzLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5maWx0ZXIoY29ubmVjdGlvblN0YXR1cyA9PiBjb25uZWN0aW9uU3RhdHVzICE9IENvbm5lY3Rpb25TdGF0dXMuVW5pbml0aWFsaXplZCAmJiBjb25uZWN0aW9uU3RhdHVzICE9IENvbm5lY3Rpb25TdGF0dXMuQ29ubmVjdGluZylcbiAgICAgICAgLmZsYXRNYXAoY29ubmVjdGlvblN0YXR1cyA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGNvbm5lY3Rpb25TdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIENvbm5lY3Rpb25TdGF0dXMuRW5kZWQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLnRocm93KGVycm9yQ29udmVyc2F0aW9uRW5kZWQsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgQ29ubmVjdGlvblN0YXR1cy5GYWlsZWRUb0Nvbm5lY3Q6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLnRocm93KGVycm9yRmFpbGVkVG9Db25uZWN0LCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG5cbiAgICAgICAgICAgICAgICBjYXNlIENvbm5lY3Rpb25TdGF0dXMuRXhwaXJlZFRva2VuOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihjb25uZWN0aW9uU3RhdHVzLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihjb25uZWN0aW9uU3RhdHVzLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIG9uY2UgPyBvYnMudGFrZSgxKSA6IG9icztcbiAgICB9XG5cbiAgICBzZXRDb25uZWN0aW9uU3RhdHVzRmFsbGJhY2soXG4gICAgICAgIGNvbm5lY3Rpb25TdGF0dXNGcm9tOiBDb25uZWN0aW9uU3RhdHVzLFxuICAgICAgICBjb25uZWN0aW9uU3RhdHVzVG86IENvbm5lY3Rpb25TdGF0dXMsXG4gICAgICAgIG1heEF0dGVtcHRzID0gNVxuICAgICkge1xuICAgICAgICBtYXhBdHRlbXB0cy0tO1xuICAgICAgICBsZXQgYXR0ZW1wdHMgPSAwO1xuICAgICAgICBsZXQgY3VyclN0YXR1cyA9IG51bGw7XG4gICAgICAgIHJldHVybiAoc3RhdHVzOiBDb25uZWN0aW9uU3RhdHVzKTogQ29ubmVjdGlvblN0YXR1cyA9PiB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSBjb25uZWN0aW9uU3RhdHVzRnJvbSAmJiBjdXJyU3RhdHVzID09PSBzdGF0dXMgJiYgYXR0ZW1wdHMgPj0gbWF4QXR0ZW1wdHMpIHtcbiAgICAgICAgICAgICAgICBhdHRlbXB0cyA9IDBcbiAgICAgICAgICAgICAgICByZXR1cm4gY29ubmVjdGlvblN0YXR1c1RvO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXR0ZW1wdHMrKztcbiAgICAgICAgICAgIGN1cnJTdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgICAgICByZXR1cm4gc3RhdHVzO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgZXhwaXJlZFRva2VuKCkge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uU3RhdHVzID0gdGhpcy5jb25uZWN0aW9uU3RhdHVzJC5nZXRWYWx1ZSgpO1xuICAgICAgICBpZiAoY29ubmVjdGlvblN0YXR1cyAhPSBDb25uZWN0aW9uU3RhdHVzLkVuZGVkICYmIGNvbm5lY3Rpb25TdGF0dXMgIT0gQ29ubmVjdGlvblN0YXR1cy5GYWlsZWRUb0Nvbm5lY3QpXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMkLm5leHQoQ29ubmVjdGlvblN0YXR1cy5FeHBpcmVkVG9rZW4pO1xuXG4gICAgICAgIGNvbnN0IHByb3RlY3RlZENvbm5lY3Rpb25TdGF0dXMgPSB0aGlzLmV4cGlyZWRUb2tlbkV4aGF1c3Rpb24odGhpcy5jb25uZWN0aW9uU3RhdHVzJC5nZXRWYWx1ZSgpKTtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzJC5uZXh0KHByb3RlY3RlZENvbm5lY3Rpb25TdGF0dXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhcnRDb252ZXJzYXRpb24oKSB7XG4gICAgICAgIC8vaWYgY29udmVyc2F0aW9uaWQgaXMgc2V0IGhlcmUsIGl0IG1lYW5zIHdlIG5lZWQgdG8gY2FsbCB0aGUgcmVjb25uZWN0IGFwaSwgZWxzZSBpdCBpcyBhIG5ldyBjb252ZXJzYXRpb25cbiAgICAgICAgY29uc3QgdXJsID0gdGhpcy5jb252ZXJzYXRpb25JZFxuICAgICAgICAgICAgPyBgJHt0aGlzLmRvbWFpbn0vY29udmVyc2F0aW9ucy8ke3RoaXMuY29udmVyc2F0aW9uSWR9P3dhdGVybWFyaz0ke3RoaXMud2F0ZXJtYXJrfWBcbiAgICAgICAgICAgIDogYCR7dGhpcy5kb21haW59L2NvbnZlcnNhdGlvbnNgO1xuICAgICAgICBjb25zdCBtZXRob2QgPSB0aGlzLmNvbnZlcnNhdGlvbklkID8gXCJHRVRcIiA6IFwiUE9TVFwiO1xuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlcy5hamF4KHtcbiAgICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dCxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICBcIkFjY2VwdFwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAuLi50aGlzLmNvbW1vbkhlYWRlcnMoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuLy8gICAgICAuZG8oYWpheFJlc3BvbnNlID0+IGtvbnNvbGUubG9nKFwiY29udmVyc2F0aW9uIGFqYXhSZXNwb25zZVwiLCBhamF4UmVzcG9uc2UucmVzcG9uc2UpKVxuICAgICAgICAubWFwKGFqYXhSZXNwb25zZSA9PiB7XG4gICAgICAgICAgICB0cnl7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuYm90SWRIZWFkZXIgKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3RJZEhlYWRlciA9IGFqYXhSZXNwb25zZS54aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ3gtbXMtYm90LWlkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2h7Lypkb24ndCBjYXJlIGlmIHRoZSBhYm92ZSB0aHJvd3MgZm9yIGFueSByZWFzb24qL31cbiAgICAgICAgICAgIHJldHVybiBhamF4UmVzcG9uc2UucmVzcG9uc2UgYXMgQ29udmVyc2F0aW9uO1xuICAgICAgICB9KVxuICAgICAgICAucmV0cnlXaGVuKGVycm9yJCA9PlxuICAgICAgICAgICAgLy8gZm9yIG5vdyB3ZSBkZWVtIDR4eCBhbmQgNXh4IGVycm9ycyBhcyB1bnJlY292ZXJhYmxlXG4gICAgICAgICAgICAvLyBmb3IgZXZlcnl0aGluZyBlbHNlICh0aW1lb3V0cyksIHJldHJ5IGZvciBhIHdoaWxlXG4gICAgICAgICAgICBlcnJvciQubWVyZ2VNYXAoKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnN0YXR1cyA+PSA0MDAgJiYgZXJyb3Iuc3RhdHVzIDwgNjAwXG4gICAgICAgICAgICAgICAgPyBPYnNlcnZhYmxlLnRocm93KGVycm9yLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcilcbiAgICAgICAgICAgICAgICA6IE9ic2VydmFibGUub2YoZXJyb3IsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5kZWxheSh0aGlzLnRpbWVvdXQsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKVxuICAgICAgICAgICAgLnRha2UodGhpcy5yZXRyaWVzKVxuICAgICAgICApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZWZyZXNoVG9rZW5Mb29wKCkge1xuICAgICAgICB0aGlzLnRva2VuUmVmcmVzaFN1YnNjcmlwdGlvbiA9IE9ic2VydmFibGUuaW50ZXJ2YWwoaW50ZXJ2YWxSZWZyZXNoVG9rZW4sIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKVxuICAgICAgICAuZmxhdE1hcChfID0+IHRoaXMucmVmcmVzaFRva2VuKCkpXG4gICAgICAgIC5zdWJzY3JpYmUodG9rZW4gPT4ge1xuICAgICAgICAgICAga29uc29sZS5sb2coXCJyZWZyZXNoaW5nIHRva2VuXCIsIHRva2VuLCBcImF0XCIsIG5ldyBEYXRlKCkpO1xuICAgICAgICAgICAgdGhpcy50b2tlbiA9IHRva2VuO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlZnJlc2hUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tDb25uZWN0aW9uKHRydWUpXG4gICAgICAgIC5mbGF0TWFwKF8gPT5cbiAgICAgICAgICAgIHRoaXMuc2VydmljZXMuYWpheCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICB1cmw6IGAke3RoaXMuZG9tYWlufS90b2tlbnMvcmVmcmVzaGAsXG4gICAgICAgICAgICAgICAgdGltZW91dDogdGhpcy50aW1lb3V0LFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5jb21tb25IZWFkZXJzKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm1hcChhamF4UmVzcG9uc2UgPT4gYWpheFJlc3BvbnNlLnJlc3BvbnNlLnRva2VuIGFzIHN0cmluZylcbiAgICAgICAgICAgIC5yZXRyeVdoZW4oZXJyb3IkID0+IGVycm9yJFxuICAgICAgICAgICAgICAgIC5tZXJnZU1hcChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQwMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIHRva2VuIGlzIGV4cGlyZWQgdGhlcmUncyBubyByZWFzb24gdG8ga2VlcCB0cnlpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwaXJlZFRva2VuKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS50aHJvdyhlcnJvciwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgYm90IGlzIGdvbmUsIHdlIHNob3VsZCBzdG9wIHJldHJ5aW5nXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS50aHJvdyhlcnJvciwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoZXJyb3IsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5kZWxheSh0aGlzLnRpbWVvdXQsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKVxuICAgICAgICAgICAgICAgIC50YWtlKHRoaXMucmV0cmllcylcbiAgICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIH1cblxuICAgIHB1YmxpYyByZWNvbm5lY3QoY29udmVyc2F0aW9uOiBDb252ZXJzYXRpb24pIHtcbiAgICAgICAgdGhpcy50b2tlbiA9IGNvbnZlcnNhdGlvbi50b2tlbjtcbiAgICAgICAgdGhpcy5zdHJlYW1VcmwgPSBjb252ZXJzYXRpb24uc3RyZWFtVXJsO1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uU3RhdHVzJC5nZXRWYWx1ZSgpID09PSBDb25uZWN0aW9uU3RhdHVzLkV4cGlyZWRUb2tlbilcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLk9ubGluZSk7XG4gICAgfVxuXG4gICAgZW5kKCkge1xuICAgICAgICBpZiAodGhpcy50b2tlblJlZnJlc2hTdWJzY3JpcHRpb24pXG4gICAgICAgICAgICB0aGlzLnRva2VuUmVmcmVzaFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzJC5uZXh0KENvbm5lY3Rpb25TdGF0dXMuRW5kZWQpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBpZiAoZSA9PT0gZXJyb3JDb252ZXJzYXRpb25FbmRlZClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB0aHJvdyhlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFNlc3Npb25JZCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgICAgICAvLyBJZiB3ZSdyZSBub3QgY29ubmVjdGVkIHRvIHRoZSBib3QsIGdldCBjb25uZWN0ZWRcbiAgICAgICAgLy8gV2lsbCB0aHJvdyBhbiBlcnJvciBpZiB3ZSBhcmUgbm90IGNvbm5lY3RlZFxuICAgICAgICBrb25zb2xlLmxvZyhcImdldFNlc3Npb25JZFwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tDb25uZWN0aW9uKHRydWUpXG4gICAgICAgICAgICAuZmxhdE1hcChfID0+XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlcy5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IGAke3RoaXMuZG9tYWlufS9zZXNzaW9uL2dldHNlc3Npb25pZGAsXG4gICAgICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogdGhpcy50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuY29tbW9uSGVhZGVycygpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5tYXAoYWpheFJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFqYXhSZXNwb25zZSAmJiBhamF4UmVzcG9uc2UucmVzcG9uc2UgJiYgYWpheFJlc3BvbnNlLnJlc3BvbnNlLnNlc3Npb25JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAga29uc29sZS5sb2coXCJnZXRTZXNzaW9uSWQgcmVzcG9uc2U6IFwiICsgYWpheFJlc3BvbnNlLnJlc3BvbnNlLnNlc3Npb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWpheFJlc3BvbnNlLnJlc3BvbnNlLnNlc3Npb25JZCBhcyBzdHJpbmc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAga29uc29sZS5sb2coXCJnZXRTZXNzaW9uSWQgZXJyb3I6IFwiICsgZXJyb3Iuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoJycsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHRoaXMuY2F0Y2hFeHBpcmVkVG9rZW4oZXJyb3IpKTtcbiAgICB9XG5cbiAgICBwb3N0QWN0aXZpdHkoYWN0aXZpdHk6IEFjdGl2aXR5KSB7XG4gICAgICAgIC8vIFVzZSBwb3N0TWVzc2FnZVdpdGhBdHRhY2htZW50cyBmb3IgbWVzc2FnZXMgd2l0aCBhdHRhY2htZW50cyB0aGF0IGFyZSBsb2NhbCBmaWxlcyAoZS5nLiBhbiBpbWFnZSB0byB1cGxvYWQpXG4gICAgICAgIC8vIFRlY2huaWNhbGx5IHdlIGNvdWxkIHVzZSBpdCBmb3IgKmFsbCogYWN0aXZpdGllcywgYnV0IHBvc3RBY3Rpdml0eSBpcyBtdWNoIGxpZ2h0ZXIgd2VpZ2h0XG4gICAgICAgIC8vIFNvLCBzaW5jZSBXZWJDaGF0IGlzIHBhcnRpYWxseSBhIHJlZmVyZW5jZSBpbXBsZW1lbnRhdGlvbiBvZiBEaXJlY3QgTGluZSwgd2UgaW1wbGVtZW50IGJvdGguXG4gICAgICAgIGlmIChhY3Rpdml0eS50eXBlID09PSBcIm1lc3NhZ2VcIiAmJiBhY3Rpdml0eS5hdHRhY2htZW50cyAmJiBhY3Rpdml0eS5hdHRhY2htZW50cy5sZW5ndGggPiAwKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zdE1lc3NhZ2VXaXRoQXR0YWNobWVudHMoYWN0aXZpdHkpO1xuXG4gICAgICAgIC8vIElmIHdlJ3JlIG5vdCBjb25uZWN0ZWQgdG8gdGhlIGJvdCwgZ2V0IGNvbm5lY3RlZFxuICAgICAgICAvLyBXaWxsIHRocm93IGFuIGVycm9yIGlmIHdlIGFyZSBub3QgY29ubmVjdGVkXG4gICAgICAgIGtvbnNvbGUubG9nKFwicG9zdEFjdGl2aXR5XCIsIGFjdGl2aXR5KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tDb25uZWN0aW9uKHRydWUpXG4gICAgICAgIC5mbGF0TWFwKF8gPT5cbiAgICAgICAgICAgIHRoaXMuc2VydmljZXMuYWpheCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICB1cmw6IGAke3RoaXMuZG9tYWlufS9jb252ZXJzYXRpb25zLyR7dGhpcy5jb252ZXJzYXRpb25JZH0vYWN0aXZpdGllc2AsXG4gICAgICAgICAgICAgICAgYm9keTogYWN0aXZpdHksXG4gICAgICAgICAgICAgICAgdGltZW91dDogdGhpcy50aW1lb3V0LFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuY29tbW9uSGVhZGVycygpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAubWFwKGFqYXhSZXNwb25zZSA9PiBhamF4UmVzcG9uc2UucmVzcG9uc2UuaWQgYXMgc3RyaW5nKVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHRoaXMuY2F0Y2hQb3N0RXJyb3IoZXJyb3IpKVxuICAgICAgICApXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB0aGlzLmNhdGNoRXhwaXJlZFRva2VuKGVycm9yKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwb3N0TWVzc2FnZVdpdGhBdHRhY2htZW50cyhtZXNzYWdlOiBNZXNzYWdlKSB7XG4gICAgICAgIGNvbnN0IHsgYXR0YWNobWVudHMgfSA9IG1lc3NhZ2U7XG4gICAgICAgIC8vIFdlIGNsZWFuIHRoZSBhdHRhY2htZW50cyBidXQgbWFraW5nIHN1cmUgZXZlcnkgYXR0YWNobWVudCBoYXMgdW5pcXVlIG5hbWUuXG4gICAgICAgIC8vIElmIHRoZSBmaWxlIGRvIG5vdCBoYXZlIGEgbmFtZSwgQ2hyb21lIHdpbGwgYXNzaWduIFwiYmxvYlwiIHdoZW4gaXQgaXMgYXBwZW5kZWQgdG8gRm9ybURhdGEuXG4gICAgICAgIGNvbnN0IGF0dGFjaG1lbnROYW1lczogc3RyaW5nW10gPSBkZWR1cGVGaWxlbmFtZXMoYXR0YWNobWVudHMubWFwKChtZWRpYTogTWVkaWEpID0+IG1lZGlhLm5hbWUgfHwgJ2Jsb2InKSk7XG4gICAgICAgIGNvbnN0IGNsZWFuc2VkQXR0YWNobWVudHMgPSBhdHRhY2htZW50cy5tYXAoKGF0dGFjaG1lbnQ6IE1lZGlhLCBpbmRleDogbnVtYmVyKSA9PiAoe1xuICAgICAgICAgICAgLi4uYXR0YWNobWVudCxcbiAgICAgICAgICAgIG5hbWU6IGF0dGFjaG1lbnROYW1lc1tpbmRleF1cbiAgICAgICAgfSkpO1xuICAgICAgICBsZXQgZm9ybURhdGE6IEZvcm1EYXRhO1xuXG4gICAgICAgIC8vIElmIHdlJ3JlIG5vdCBjb25uZWN0ZWQgdG8gdGhlIGJvdCwgZ2V0IGNvbm5lY3RlZFxuICAgICAgICAvLyBXaWxsIHRocm93IGFuIGVycm9yIGlmIHdlIGFyZSBub3QgY29ubmVjdGVkXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQ29ubmVjdGlvbih0cnVlKVxuICAgICAgICAuZmxhdE1hcChfID0+IHtcbiAgICAgICAgICAgIC8vIFRvIHNlbmQgdGhpcyBtZXNzYWdlIHRvIERpcmVjdExpbmUgd2UgbmVlZCB0byBkZWNvbnN0cnVjdCBpdCBpbnRvIGEgXCJ0ZW1wbGF0ZVwiIGFjdGl2aXR5XG4gICAgICAgICAgICAvLyBhbmQgb25lIGJsb2IgZm9yIGVhY2ggYXR0YWNobWVudC5cbiAgICAgICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2FjdGl2aXR5JywgbmV3IEJsb2IoW0pTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAuLi5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIC8vIFJlbW92aW5nIGNvbnRlbnRVcmwgZnJvbSBhdHRhY2htZW50LCB3ZSB3aWxsIHNlbmQgaXQgdmlhIG11bHRpcGFydFxuICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRzOiBjbGVhbnNlZEF0dGFjaG1lbnRzLm1hcCgoeyBjb250ZW50VXJsOiBzdHJpbmcsIC4uLm90aGVycyB9KSA9PiAoeyAuLi5vdGhlcnMgfSkpXG4gICAgICAgICAgICB9KV0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL3ZuZC5taWNyb3NvZnQuYWN0aXZpdHknIH0pKTtcblxuICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuZnJvbShjbGVhbnNlZEF0dGFjaG1lbnRzLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcilcbiAgICAgICAgICAgIC5mbGF0TWFwKChtZWRpYTogTWVkaWEpID0+XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlcy5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IG1lZGlhLmNvbnRlbnRVcmwsXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2FycmF5YnVmZmVyJ1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmRvKGFqYXhSZXNwb25zZSA9PlxuICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBuZXcgQmxvYihbYWpheFJlc3BvbnNlLnJlc3BvbnNlXSwgeyB0eXBlOiBtZWRpYS5jb250ZW50VHlwZSB9KSwgbWVkaWEubmFtZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuY291bnQoKVxuICAgICAgICB9KVxuICAgICAgICAuZmxhdE1hcChfID0+XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2VzLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgdXJsOiBgJHt0aGlzLmRvbWFpbn0vY29udmVyc2F0aW9ucy8ke3RoaXMuY29udmVyc2F0aW9uSWR9L3VwbG9hZD91c2VySWQ9JHttZXNzYWdlLmZyb20uaWR9YCxcbiAgICAgICAgICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgICAgICAgICAgICB0aW1lb3V0OiB0aGlzLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmNvbW1vbkhlYWRlcnMoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAubWFwKGFqYXhSZXNwb25zZSA9PiBhamF4UmVzcG9uc2UucmVzcG9uc2UuaWQgYXMgc3RyaW5nKVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHRoaXMuY2F0Y2hQb3N0RXJyb3IoZXJyb3IpKVxuICAgICAgICApXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB0aGlzLmNhdGNoUG9zdEVycm9yKGVycm9yKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYXRjaFBvc3RFcnJvcihlcnJvcjogYW55KSB7XG4gICAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQwMylcbiAgICAgICAgICAgIC8vIHRva2VuIGhhcyBleHBpcmVkICh3aWxsIGZhbGwgdGhyb3VnaCB0byByZXR1cm4gXCJyZXRyeVwiKVxuICAgICAgICAgICAgdGhpcy5leHBpcmVkVG9rZW4oKTtcbiAgICAgICAgZWxzZSBpZiAoZXJyb3Iuc3RhdHVzID49IDQwMCAmJiBlcnJvci5zdGF0dXMgPCA1MDApXG4gICAgICAgICAgICAvLyBtb3JlIHVucmVjb3ZlcmFibGUgZXJyb3JzXG4gICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS50aHJvdyhlcnJvciwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpO1xuICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihcInJldHJ5XCIsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhdGNoRXhwaXJlZFRva2VuKGVycm9yOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yID09PSBlcnJvckV4cGlyZWRUb2tlblxuICAgICAgICA/IE9ic2VydmFibGUub2YoXCJyZXRyeVwiLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcilcbiAgICAgICAgOiBPYnNlcnZhYmxlLnRocm93KGVycm9yLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwb2xsaW5nR2V0QWN0aXZpdHkkKCkge1xuICAgICAgICBjb25zdCBwb2xsZXIkOiBPYnNlcnZhYmxlPEFqYXhSZXNwb25zZT4gPSBPYnNlcnZhYmxlLmNyZWF0ZSgoc3Vic2NyaWJlcjogU3Vic2NyaWJlcjxhbnk+KSA9PiB7XG4gICAgICAgICAgICAvLyBBIEJlaGF2aW9yU3ViamVjdCB0byB0cmlnZ2VyIHBvbGxpbmcuIFNpbmNlIGl0IGlzIGEgQmVoYXZpb3JTdWJqZWN0XG4gICAgICAgICAgICAvLyB0aGUgZmlyc3QgZXZlbnQgaXMgcHJvZHVjZWQgaW1tZWRpYXRlbHkuXG4gICAgICAgICAgICBjb25zdCB0cmlnZ2VyJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55Pih7fSk7XG5cbiAgICAgICAgICAgIC8vIFRPRE86IHJlbW92ZSBEYXRlLm5vdywgdXNlIHJlYWN0aXZlIGludGVydmFsIHRvIHNwYWNlIG91dCBldmVyeSByZXF1ZXN0XG5cbiAgICAgICAgICAgIHRyaWdnZXIkLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXR1cyQuZ2V0VmFsdWUoKSA9PT0gQ29ubmVjdGlvblN0YXR1cy5PbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZXMuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5jb21tb25IZWFkZXJzKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBgJHsgdGhpcy5kb21haW4gfS9jb252ZXJzYXRpb25zLyR7IHRoaXMuY29udmVyc2F0aW9uSWQgfS9hY3Rpdml0aWVzP3dhdGVybWFyaz0keyB0aGlzLndhdGVybWFyayB9YCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dFxuICAgICAgICAgICAgICAgICAgICB9KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAocmVzdWx0OiBBamF4UmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLm5leHQocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRyaWdnZXIkLm5leHQobnVsbCksIE1hdGgubWF4KDAsIHRoaXMucG9sbGluZ0ludGVydmFsIC0gRGF0ZS5ub3coKSArIHN0YXJ0VGltZXN0YW1wKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGVycm9yLnN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQwMzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLkV4cGlyZWRUb2tlbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRyaWdnZXIkLm5leHQobnVsbCksIHRoaXMucG9sbGluZ0ludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzJC5uZXh0KENvbm5lY3Rpb25TdGF0dXMuRW5kZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByb3BhZ2F0ZSB0aGUgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja0Nvbm5lY3Rpb24oKVxuICAgICAgICAuZmxhdE1hcChfID0+IHBvbGxlciRcbiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiBPYnNlcnZhYmxlLmVtcHR5PEFqYXhSZXNwb25zZT4oKSlcbiAgICAgICAgICAgIC5tYXAoYWpheFJlc3BvbnNlID0+IGFqYXhSZXNwb25zZS5yZXNwb25zZSBhcyBBY3Rpdml0eUdyb3VwKVxuICAgICAgICAgICAgLmZsYXRNYXAoYWN0aXZpdHlHcm91cCA9PiB0aGlzLm9ic2VydmFibGVGcm9tQWN0aXZpdHlHcm91cChhY3Rpdml0eUdyb3VwKSkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb2JzZXJ2YWJsZUZyb21BY3Rpdml0eUdyb3VwKGFjdGl2aXR5R3JvdXA6IEFjdGl2aXR5R3JvdXApIHtcbiAgICAgICAgaWYgKGFjdGl2aXR5R3JvdXAud2F0ZXJtYXJrKVxuICAgICAgICAgICAgdGhpcy53YXRlcm1hcmsgPSBhY3Rpdml0eUdyb3VwLndhdGVybWFyaztcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuZnJvbShhY3Rpdml0eUdyb3VwLmFjdGl2aXRpZXMsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHdlYlNvY2tldEFjdGl2aXR5JCgpOiBPYnNlcnZhYmxlPEFjdGl2aXR5PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQ29ubmVjdGlvbigpXG4gICAgICAgIC5mbGF0TWFwKF8gPT5cbiAgICAgICAgICAgIHRoaXMub2JzZXJ2YWJsZVdlYlNvY2tldDxBY3Rpdml0eUdyb3VwPigpXG4gICAgICAgICAgICAvLyBXZWJTb2NrZXRzIGNhbiBiZSBjbG9zZWQgYnkgdGhlIHNlcnZlciBvciB0aGUgYnJvd3Nlci4gSW4gdGhlIGZvcm1lciBjYXNlIHdlIG5lZWQgdG9cbiAgICAgICAgICAgIC8vIHJldHJpZXZlIGEgbmV3IHN0cmVhbVVybC4gSW4gdGhlIGxhdHRlciBjYXNlIHdlIGNvdWxkIGZpcnN0IHJldHJ5IHdpdGggdGhlIGN1cnJlbnQgc3RyZWFtVXJsLFxuICAgICAgICAgICAgLy8gYnV0IGl0J3Mgc2ltcGxlciBqdXN0IHRvIGFsd2F5cyBmZXRjaCBhIG5ldyBvbmUuXG4gICAgICAgICAgICAucmV0cnlXaGVuKGVycm9yJCA9PiBlcnJvciQuZGVsYXkodGhpcy5nZXRSZXRyeURlbGF5KCksIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKS5tZXJnZU1hcChlcnJvciA9PiB0aGlzLnJlY29ubmVjdFRvQ29udmVyc2F0aW9uKCkpKVxuICAgICAgICApXG4gICAgICAgIC5mbGF0TWFwKGFjdGl2aXR5R3JvdXAgPT4gdGhpcy5vYnNlcnZhYmxlRnJvbUFjdGl2aXR5R3JvdXAoYWN0aXZpdHlHcm91cCkpXG4gICAgfVxuXG4gICAgLy8gUmV0dXJucyB0aGUgZGVsYXkgZHVyYXRpb24gaW4gbWlsbGlzZWNvbmRzXG4gICAgcHJpdmF0ZSBnZXRSZXRyeURlbGF5KCkge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigzMDAwICsgdGhpcy5zZXJ2aWNlcy5yYW5kb20oKSAqIDEyMDAwKTtcbiAgICB9XG5cbiAgICAvLyBPcmlnaW5hbGx5IHdlIHVzZWQgT2JzZXJ2YWJsZS53ZWJTb2NrZXQsIGJ1dCBpdCdzIGZhaXJseSBvcGluaW9uYXRlZCBhbmQgSSBlbmRlZCB1cCB3cml0aW5nXG4gICAgLy8gYSBsb3Qgb2YgY29kZSB0byB3b3JrIGFyb3VuZCB0aGVpciBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzLiBTaW5jZSBXZWJDaGF0IGlzIG1lYW50IHRvIGJlIGEgcmVmZXJlbmNlXG4gICAgLy8gaW1wbGVtZW50YXRpb24sIEkgZGVjaWRlZCByb2xsIHRoZSBiZWxvdywgd2hlcmUgdGhlIGxvZ2ljIGlzIG1vcmUgcHVycG9zZWZ1bC4gLSBAYmlsbGJhXG4gICAgcHJpdmF0ZSBvYnNlcnZhYmxlV2ViU29ja2V0PFQ+KCkge1xuICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoKHN1YnNjcmliZXI6IFN1YnNjcmliZXI8VD4pID0+IHtcbiAgICAgICAgICAgIGtvbnNvbGUubG9nKFwiY3JlYXRpbmcgV2ViU29ja2V0XCIsIHRoaXMuc3RyZWFtVXJsKTtcbiAgICAgICAgICAgIGNvbnN0IHdzID0gbmV3IHRoaXMuc2VydmljZXMuV2ViU29ja2V0KHRoaXMuc3RyZWFtVXJsKTtcbiAgICAgICAgICAgIGxldCBzdWI6IFN1YnNjcmlwdGlvbjtcblxuICAgICAgICAgICAgd3Mub25vcGVuID0gb3BlbiA9PiB7XG4gICAgICAgICAgICAgICAga29uc29sZS5sb2coXCJXZWJTb2NrZXQgb3BlblwiLCBvcGVuKTtcbiAgICAgICAgICAgICAgICAvLyBDaHJvbWUgaXMgcHJldHR5IGJhZCBhdCBub3RpY2luZyB3aGVuIGEgV2ViU29ja2V0IGNvbm5lY3Rpb24gaXMgYnJva2VuLlxuICAgICAgICAgICAgICAgIC8vIElmIHdlIHBlcmlvZGljYWxseSBwaW5nIHRoZSBzZXJ2ZXIgd2l0aCBlbXB0eSBtZXNzYWdlcywgaXQgaGVscHMgQ2hyb21lXG4gICAgICAgICAgICAgICAgLy8gcmVhbGl6ZSB3aGVuIGNvbm5lY3Rpb24gYnJlYWtzLCBhbmQgY2xvc2UgdGhlIHNvY2tldC4gV2UgdGhlbiB0aHJvdyBhblxuICAgICAgICAgICAgICAgIC8vIGVycm9yLCBhbmQgdGhhdCBnaXZlIHVzIHRoZSBvcHBvcnR1bml0eSB0byBhdHRlbXB0IHRvIHJlY29ubmVjdC5cbiAgICAgICAgICAgICAgICBzdWIgPSBPYnNlcnZhYmxlLmludGVydmFsKHRoaXMudGltZW91dCwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpLnN1YnNjcmliZShfID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdzLnNlbmQoXCJcIilcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrb25zb2xlLmxvZyhcIlBpbmcgZXJyb3JcIiwgZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd3Mub25jbG9zZSA9IGNsb3NlID0+IHtcbiAgICAgICAgICAgICAgICBrb25zb2xlLmxvZyhcIldlYlNvY2tldCBjbG9zZVwiLCBjbG9zZSk7XG4gICAgICAgICAgICAgICAgaWYgKHN1Yikgc3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgc3Vic2NyaWJlci5lcnJvcihjbG9zZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdzLm9ubWVzc2FnZSA9IG1lc3NhZ2UgPT4gbWVzc2FnZS5kYXRhICYmIHN1YnNjcmliZXIubmV4dChKU09OLnBhcnNlKG1lc3NhZ2UuZGF0YSkpO1xuXG4gICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSAndW5zdWJzY3JpYmUnIG1ldGhvZCwgd2hpY2ggaXMgY2FsbGVkIHdoZW4gdGhpcyBvYnNlcnZhYmxlIGlzIGRpc3Bvc2VkLlxuICAgICAgICAgICAgLy8gV2hlbiB0aGUgV2ViU29ja2V0IGNsb3NlcyBpdHNlbGYsIHdlIHRocm93IGFuIGVycm9yLCBhbmQgdGhpcyBmdW5jdGlvbiBpcyBldmVudHVhbGx5IGNhbGxlZC5cbiAgICAgICAgICAgIC8vIFdoZW4gdGhlIG9ic2VydmFibGUgaXMgY2xvc2VkIGZpcnN0IChlLmcuIHdoZW4gdGVhcmluZyBkb3duIGEgV2ViQ2hhdCBpbnN0YW5jZSkgdGhlblxuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBtYW51YWxseSBjbG9zZSB0aGUgV2ViU29ja2V0LlxuICAgICAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAod3MucmVhZHlTdGF0ZSA9PT0gMCB8fCB3cy5yZWFkeVN0YXRlID09PSAxKSB3cy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSBhcyBPYnNlcnZhYmxlPFQ+XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZWNvbm5lY3RUb0NvbnZlcnNhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tDb25uZWN0aW9uKHRydWUpXG4gICAgICAgIC5mbGF0TWFwKF8gPT5cbiAgICAgICAgICAgIHRoaXMuc2VydmljZXMuYWpheCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgIHVybDogYCR7dGhpcy5kb21haW59L2NvbnZlcnNhdGlvbnMvJHt0aGlzLmNvbnZlcnNhdGlvbklkfT93YXRlcm1hcms9JHt0aGlzLndhdGVybWFya31gLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dCxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQWNjZXB0XCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmNvbW1vbkhlYWRlcnMoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZG8ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2VjcmV0KVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRva2VuID0gcmVzdWx0LnJlc3BvbnNlLnRva2VuO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtVXJsID0gcmVzdWx0LnJlc3BvbnNlLnN0cmVhbVVybDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAubWFwKF8gPT4gbnVsbClcbiAgICAgICAgICAgIC5yZXRyeVdoZW4oZXJyb3IkID0+IGVycm9yJFxuICAgICAgICAgICAgICAgIC5tZXJnZU1hcChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQwMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG9rZW4gaGFzIGV4cGlyZWQuIFdlIGNhbid0IHJlY292ZXIgZnJvbSB0aGlzIGhlcmUsIGJ1dCB0aGUgZW1iZWRkaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZWJzaXRlIG1pZ2h0IGV2ZW50dWFsbHkgY2FsbCByZWNvbm5lY3QoKSB3aXRoIGEgbmV3IHRva2VuIGFuZCBzdHJlYW1VcmwuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGlyZWRUb2tlbigpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS50aHJvdyhlcnJvckNvbnZlcnNhdGlvbkVuZGVkLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihlcnJvciwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmRlbGF5KHRoaXMudGltZW91dCwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpXG4gICAgICAgICAgICAgICAgLnRha2UodGhpcy5yZXRyaWVzKVxuICAgICAgICAgICAgKVxuICAgICAgICApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb21tb25IZWFkZXJzKCkge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgICAgIFwiQXV0aG9yaXphdGlvblwiOiBgQmVhcmVyICR7dGhpcy50b2tlbn1gLFxuICAgICAgICAgICAgICAgIFwieC1tcy1ib3QtYWdlbnRcIjogdGhpcy5fYm90QWdlbnRcbiAgICAgICAgICAgIH0sICB0aGlzLmJvdElkSGVhZGVyID8geyd4LW1zLWJvdC1pZCc6IHRoaXMuYm90SWRIZWFkZXJ9OiBudWxsKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEJvdEFnZW50KGN1c3RvbUFnZW50OiBzdHJpbmcgPSAnJyk6IHN0cmluZyB7XG4gICAgICAgIGxldCBjbGllbnRBZ2VudCA9ICdkaXJlY3RsaW5lanMnXG5cbiAgICAgICAgaWYgKGN1c3RvbUFnZW50KSB7XG4gICAgICAgICAgICBjbGllbnRBZ2VudCArPSBgOyAke2N1c3RvbUFnZW50fWBcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBgJHtESVJFQ1RfTElORV9WRVJTSU9OfSAoJHtjbGllbnRBZ2VudH0gJHtwcm9jZXNzLmVudi5ucG1fcGFja2FnZV92ZXJzaW9ufSlgO1xuICAgIH1cblxuXG59XG4iXX0=